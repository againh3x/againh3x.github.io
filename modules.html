<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PublicForumAI Learning App</title>
  <style>
    /*
      Simple single–page application that mirrors the structure of the
      original Tkinter program.  The layout is split into a fixed
      sidebar containing a list of modules and a main pane that
      displays individual pages of each module.  A dark, modern
      colour scheme inspired by PublicForumAI’s home page ties
      everything together.

      Colours are defined as CSS variables at the top to make
      adjustments easy.  Elements such as buttons and progress bars
      respond to hover states and transitions for a polished feel.
    */
    :root {
      --primary-color: #3498db;      /* vibrant blue */
      --secondary-color: #9b59b6;    /* purple */
      --accent-color: #f1c40f;       /* gold/yellow */
      --background-dark: #01172d;    /* deep navy background */
      --background-light: #0a235a;   /* lighter panel background */
      --card-bg: #11254b;            /* card background */
      --text-color: #e0f4ff;         /* off‑white text */
      --shadow-color: rgba(0,0,0,0.3);
    }

    html, body {
      margin: 0;
      padding: 0;
      height: 110%;
      font-family: 'Roboto', sans-serif;
      color: var(--text-color);
    }

    body {
      background: linear-gradient(180deg,#75bfff,#0015a1,#5ab2ff,#0015a1,var(--background-dark));
      display: flex;
      flex-direction: column;
    }

    /* Container for the entire app */
    .app-container {
  min-height: 100vh;
      display: flex;
      flex: 1;
      max-width: 1200px;
      margin: 0 auto;
      width: 100%;
      box-shadow: 0 0 20px var(--shadow-color);
      border-radius: 10px;
      overflow: hidden;
      background: rgba(255,255,255,0.05);
      backdrop-filter: blur(8px);
    }

    /* Sidebar with module list */
    .sidebar {
      background: rgba(10,35,66,0.95);
      width: 250px;
      padding: 20px;
      box-sizing: border-box;
      border-right: 1px solid rgba(125,211,252,0.2);
    
  max-height: 100vh;
  overflow-y: auto;
  -webkit-overflow-scrolling: touch;
}
    .sidebar h2 {
      margin-top: 0;
      margin-bottom: 20px;
      font-size: 1.5rem;
      color: var(--primary-color);
      text-shadow: 0 0 8px rgba(255,255,255,0.2);
    }
    .module-list {
      list-style: none;
      padding: 0;
      margin: 0;
    }
    .module-item {
      margin-bottom: 10px;
    }
    .module-button {
      display: block;
      width: 100%;
      padding: 12px 14px;
      background: linear-gradient(145deg,#3B82F6,#2563EB);
      border: 1px solid rgba(125,211,252,0.4);
      border-radius: 8px;
      color: var(--text-color);
      font-size: 1rem;
      text-align: left;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
    }
    .module-button:hover,
    .module-button.active {
      background: linear-gradient(145deg,#2563EB,#1747a2);
      box-shadow: 0 4px 20px rgba(59,130,246,0.3);
    }
    .module-button .title {
      font-weight: bold;
      margin-bottom: 4px;
    }
    .module-button .status {
      font-size: 0.8rem;
      opacity: 0.7;
    }

    /* Main content area */
    .content {
      flex: 1;
      display: flex;
      flex-direction: column;
      background: rgba(10,35,66,0.9);
      padding: 20px;
      box-sizing: border-box;
    }
    .content-header {
      font-size: 1.8rem;
      font-weight: bold;
      margin-bottom: 10px;
      color: var(--primary-color);
      text-shadow: 0 0 10px rgba(125,211,252,0.3);
    }
    .page-container {
      flex: 1;
      overflow-y: auto;
      padding-right: 8px;
    }
    .card {
      background: var(--card-bg);
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      margin-bottom: 20px;
    }
    .card h3 {
      margin-top: 0;
      color: var(--primary-color);
    }
    .options-group {
      margin-top: 10px;
    }
    .options-group label {
      display: block;
      margin-bottom: 10px;
      cursor: pointer;
    }
    /* Navigation buttons at bottom of page */
    .nav-controls {
      display: flex;
      justify-content: space-between;
      margin-top: 10px;
    }
    .nav-button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 1rem;
      cursor: pointer;
      transition: background 0.2s ease;
      color: white;
    }
    .nav-button.back {
      background: var(--secondary-color);
    }
    .nav-button.next {
      background: var(--primary-color);
    }
    .nav-button:disabled {
      opacity: 0.5;
      cursor: not-allowed;
    }
    .nav-button.back:hover:not(:disabled) {
      background: #7f3fbf;
    }
    .nav-button.next:hover:not(:disabled) {
      background: #1d4fa7;
    }

    /* Progress bar styling */
    .progress-container {
      height: 8px;
      width: 100%;
      background: rgba(255,255,255,0.1);
      border-radius: 4px;
      margin-top: 10px;
      overflow: hidden;
    }
    .progress-bar {
      height: 100%;
      background: var(--accent-color);
      width: 0;
      transition: width 0.3s ease;
    }

    /* Form input styling */
    .form-input, textarea {
      width: 100%;
      padding: 8px;
      border: 1px solid rgba(125,211,252,0.3);
      border-radius: 4px;
      background: rgba(255,255,255,0.05);
      color: var(--text-color);
      box-sizing: border-box;
      margin-top: 4px;
    }


/* === Accessibility Contrast Fixes === */
/* Make text inside highlights readable on dark UI */
mark {
  background: rgba(0,0,0,0.35) !important;
  color: #ffffff !important;
  padding: 0.05em 0.25em;
  border-radius: 0.25em;
  box-shadow: inset 0 0 0 1px rgba(255,255,255,0.25);
}

/* Pills and quiz labels now live on dark cards, so set their text to white for contrast */
.pill,
.pill.claim,
.pill.warrant,
.pill.evidence,
.pill.impact {
  color: #ffffff !important;
}

/* Radio/checkbox label chips in quizzes and other choices */
.choice,
.quiz label {
  color: #ffffff !important;
}

/* If any inline yellow highlights were used via inline style, force readable text */
*[style*="background: yellow"],
*[style*="background-color: yellow"],
*[style*="background: rgb(255,255,0)"],
*[style*="background-color: rgb(255,255,0)"],
*[style*="background: #ffff"],
*[style*="background-color: #ffff"] {
  color: #0b1a2b !important;
}
</style>
<style id="pfai-toolbar-and-tweaks">
/* === PFAI Patch: Toolbar + Layout Tweaks (non-destructive) === */
:root { --toolbar-accent: #6FCBFF; }

/* Toolbar base */
nav.toolbar,
.toolbar {
  position: fixed;
  top: 0; left: 0; right: 0;
  background: linear-gradient(135deg, #0a0e27 0%, #1a1f4b 100%);
  border-bottom: 1px solid rgba(0,255,255,0.2);
  display: flex; justify-content: space-between; align-items: center;
  padding: 10px 30px;
  z-index: 1000;
  backdrop-filter: blur(10px);
  box-shadow: 0 4px 30px rgba(0,0,0,0.3);
}
.toolbar::before {
  content: '';
  position: absolute; top:0; left:-100%;
  width: 200%; height: 100%;
  background: linear-gradient(90deg, transparent 25%, rgba(0,255,255,0.08) 50%, transparent 75%);
  animation: scanner-beam 8s infinite linear;
}
@keyframes scanner-beam { 0% { transform: translateX(0); } 100% { transform: translateX(100%); } }

/* Logo + links */
nav.toolbar .logo { display:flex; align-items:center; gap:15px; text-decoration:none; }
nav.toolbar .logo img { height: 40px; filter: drop-shadow(0 0 8px rgba(0,255,255,0.4)); transition: all 0.3s ease; }
nav.toolbar .logo:hover img { filter: drop-shadow(0 0 12px rgba(0,255,255,0.6)); }
nav.toolbar .logo-text { color: var(--toolbar-accent) !important; font-weight: 700 !important; font-family: 'Roboto', sans-serif !important; }

nav.toolbar .nav-links { display:flex; gap:60px !important; position:relative; }
nav.toolbar .nav-links a {
  color: var(--toolbar-accent) !important;
  font-weight: 700 !important;
  font-family: 'Roboto', sans-serif !important;
  font-size: 1rem !important;
  text-decoration: none;
  position: relative;
  padding: 5px 0;
  background: linear-gradient(120deg, transparent 0%, transparent 50%, rgba(163,220,255,0.18) 100%);
  background-size: 200% 100%;
  transition: all 0.3s ease;
}
nav.toolbar .nav-links a::after {
  content: '';
  position: absolute; bottom: -2px; left: 0;
  width: 0; height: 2px; background: var(--toolbar-accent);
  transition: width 0.3s ease;
}
nav.toolbar .nav-links a:hover { background-position: -100% 0 !important; }
nav.toolbar .nav-links a:hover::after { width: 100% !important; }

/* Sign In button (decoupled from other .button styles) */
nav.toolbar #authSlot a,
nav.toolbar #authSlot a:hover,
nav.toolbar #authSlot .button.signin,
nav.toolbar #authSlot .button.signin:hover,
nav.toolbar #authSlot .button.signin .title,
nav.toolbar #authSlot .button.signin .title:hover {
  text-decoration: none !important;
  background: none !important;
  position: static !important;
}
nav.toolbar #authSlot .button.signin {
  border: 2px solid var(--toolbar-accent) !important;
  color: var(--toolbar-accent) !important;
  padding: 10px 16px !important;
  border-radius: 12px !important;
  display: inline-flex !important; align-items: center; justify-content: center;
  box-shadow: 0 0 0 2px rgba(134,196,255,0.08) inset !important;
}
nav.toolbar #authSlot .button.signin .title {
  font-family: 'Roboto', sans-serif !important;
  font-weight: 700 !important; font-size: 1rem !important; line-height: 1 !important;
  margin: 0 !important; text-transform: uppercase !important; letter-spacing: 0.3px !important;
}
nav.toolbar #authSlot .button.signin:hover { background: var(--toolbar-accent) !important; color: #0a0e27 !important; }
nav.toolbar #authSlot .button.signin:hover .title { color: #0a0e27 !important; }

/* Avoid overlap with fixed toolbar */
body { padding-top: 64px; }

/* ===== App Tweaks ===== */
/* Wider content area without touching original rules (override via cascade) */
.app-container { max-width: 1400px !important; }

/* Sidebar module buttons: nicer look + numbers (CSS counter, no JS changes) */
.module-list { counter-reset: pfai-mod; }
.module-item .module-button {
  position: relative;
  padding-left: 54px;                 /* room for number badge */
  border-radius: 10px;
  border: 1px solid rgba(125,211,252,0.55);
  box-shadow: 0 6px 18px rgba(59,130,246,0.20);
}
.module-item .module-button::before {
  counter-increment: pfai-mod;
  content: counter(pfai-mod);
  position: absolute; left: 14px; top: 50%; transform: translateY(-50%);
  width: 30px; height: 30px; border-radius: 50%;
  display: grid; place-items: center;
  font-weight: 800;
  background: rgba(255,255,255,0.08);
  border: 1.5px solid rgba(125,211,252,0.7);
  color: #e6f6ff;
  text-shadow: 0 1px 2px rgba(0,0,0,0.35);
  box-shadow: inset 0 0 0 2px rgba(0,0,0,0.1);
}
.module-item .module-button:hover,
.module-item .module-button.active {
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(59,130,246,0.30);
}

</style>
<style>

/* === PFAI Compact Spacing + Sidebar Styles (injected v3) === */
:root{
  --pfai-accent:#6FCBFF;
  --pfai-accent-dark:#1D7FD1;
  --pfai-ok:#16a34a;
  --pfai-ok-dark:#15803d;
}

.app-container{ max-width: 1400px !important; margin-top: 4px !important; }

#page-container{ 
  max-height: calc(100vh - 160px) !important; 
  overflow-y: auto !important; 
  padding-right: 8px !important; 
}
.content{ padding: 10px 12px !important; }
.content h2, .content h3{ margin: 6px 0 8px 0 !important; }
.card{ padding: 12px 14px !important; margin: 8px 0 !important; }
.nav-controls{ margin-top: 6px !important; }

.module-item .module-button{
  position: relative;
  background: linear-gradient(145deg, #0d5db8, var(--pfai-accent)) !important;
  border: 1px solid rgba(125,211,252,0.55) !important;
  color: #f8fbff !important;
  transition: transform .12s ease, box-shadow .12s ease, filter .12s ease;
}
.module-item .module-button:hover,
.module-item .module-button.active{
  filter: brightness(1.06);
  transform: translateY(-1px);
  box-shadow: 0 10px 24px rgba(49, 166, 255, 0.30) !important;
}

.module-item .module-button.completed{
  background: linear-gradient(145deg, var(--pfai-ok), var(--pfai-ok-dark)) !important;
  border-color: rgba(34,197,94,0.6) !important;
}
.module-item .module-button.completed::after{
  content: "✓";
  position: absolute;
  right: 12px;
  top: 50%;
  transform: translateY(-50%);
  font-weight: 900;
  font-size: 14px;
}

.module-item .module-button.locked{ pointer-events: none !important;
  background: linear-gradient(145deg, #334155, #0f172a) !important;
  border-color: rgba(148,163,184,0.35) !important;
  opacity: 0.7 !important;
  cursor: not-allowed !important;
}
.module-item .module-button.locked .status{ color: #93a2b8 !important; }

.module-item .module-button .status{
  font-weight: 700 !important;
  padding: 2px 8px !important;
  border-radius: 10px !important;
  background: rgba(0,0,0,0.18) !important;
}

</style>
<style>

/* === Spacing fix: prevent toolbar overlap === */
.app-container{ margin-top: 12px !important; }
.sidebar{ margin-top: 8px !important; }

</style>
<style>

/* Emphasize completed/locked text color */
.module-item .module-button.completed .title,
.module-item .module-button.completed .status{ color: #eaffea !important; }
.module-item .module-button.locked .title,
.module-item .module-button.locked .status{ color: #c7d2fe !important; }
  /* === Fill viewport (between toolbar and gem bar) and keep sidebar/content equal height === */
  :root {
    --toolbar-h: 64px;   /* matches body padding-top you already set */
    --gembar-h: 44px;    /* adjust if your gem bar is taller/shorter */
  }

  /* Make the whole app frame taller (and fixed in height) */
  .app-container{
    height: calc(100vh - var(--toolbar-h) - var(--gembar-h) - 24px) !important; /* the 24px accounts for your small top margin */
    min-height: unset !important;
    align-items: stretch !important; /* ensure children stretch */
  }

  /* Sidebar + content should be exactly the same height as the container */
  .sidebar,
  .content{
    height: 100% !important;
  }

  /* Sidebar should scroll internally if it overflows, not the page */
  .sidebar{
    max-height: none !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Let the page area inside content take up remaining space and scroll */
  #page-container{
    flex: 1 1 auto !important;
    min-height: 0 !important;         /* important for flexbox overflow */
    max-height: none !important;       /* remove previous cap */
    overflow-y: auto !important;
    padding-right: 8px !important;
  }

  /* Optional: lock in gem bar height so the calc above stays accurate */
  .gem-bar{
    height: var(--gembar-h);
    box-sizing: border-box;
  }
    /* === Exact-fit between fixed toolbar and gem bar === */
  :root{
    --toolbar-h: 64px; /* same as your body padding-top */
    --gembar-h: 44px;  /* tweak to your actual gem bar height */
  }

  /* Make sure the content is offset by the toolbar height only */
  body{ padding-top: var(--toolbar-h) !important; }

  /* Remove the extra margins that push the app down and break the calc */
  .app-container{ margin-top: 0 !important; }
  .sidebar{ margin-top: 0 !important; }

  /* Size the app frame to the remaining viewport height */
  .app-container{
    height: calc(100vh - var(--toolbar-h) - var(--gembar-h)) !important;  /* fallback */
    height: calc(100dvh - var(--toolbar-h) - var(--gembar-h)) !important; /* precise on mobile */
    min-height: 0 !important;
    align-items: stretch !important;
  }

  /* Sidebar and content match heights; scroll internally when needed */
  .sidebar, .content{ height: 100% !important; }
  .sidebar{
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }
  #page-container{
    flex: 1 1 auto !important;
    min-height: 0 !important;  /* critical for flex overflow */
    overflow-y: auto !important;
    padding-right: 8px !important;
  }

  /* Lock in gem bar height so the math stays true */
  .gem-bar{
    height: var(--gembar-h);
    box-sizing: border-box;
  }
    /* Use dynamic viewport & keep body padding inside the height */
  :root { --toolbar-h: 64px; } /* your toolbar height */

  html, body { height: auto !important; min-height: 100dvh !important; }
  body { padding-top: var(--toolbar-h) !important; }

  /* Fill the viewport below the toolbar (no gem bar subtraction) */
  .app-container{
    margin-top: 0 !important;
    height: calc(100dvh - var(--toolbar-h)) !important;
    min-height: 0 !important;
    align-items: stretch !important;
  }

  /* Kill the earlier hard cap that fights our math */
  #page-container{
    max-height: none !important;
    flex: 1 1 auto !important;
    min-height: 0 !important;
    overflow-y: auto !important;
    padding-right: 8px !important;
  }

  /* Keep sidebar/content equal height with internal scrolling */
  .sidebar, .content { height: 100% !important; }
  .sidebar { overflow-y: auto !important; -webkit-overflow-scrolling: touch; }

  /* Nuke any earlier spacing nudges */
  .app-container, .sidebar { margin-top: 0 !important; }
</style>
<style id="pfai-fixed-viewport">
  :root { --toolbar-h: 64px; } /* will be auto-updated by the tiny script below */

  /* Keep the page offset only for the fixed toolbar */
  body { padding-top: var(--toolbar-h) !important; }

  /* Lock the app frame to the visible viewport (minus toolbar), no growth with content */
  .app-container{
    height: calc(100dvh - var(--toolbar-h)) !important; /* dvh = correct on mobile */
    min-height: 0 !important;
    margin-top: 0 !important;
    overflow: hidden !important;

    /* Ensure sidebar/content are same height without flex surprises */
    display: grid !important;
    grid-template-columns: 250px 1fr !important;
  }

  /* Sidebar and content match heights and scroll internally */
  .sidebar, .content{
    height: 100% !important;
    min-height: 0 !important;
  }
  .sidebar{
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Make the content a column: header + scrollable page + fixed nav/progress */
  .content{
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
  }

  /* Your page area MUST be the only thing that scrolls in the content pane */
  #page-container, .page-container{
    flex: 1 1 auto !important;
    min-height: 0 !important;
    max-height: none !important;     /* kill earlier calc(100vh - 160px) cap */
    overflow-y: auto !important;
    padding-right: 8px !important;
  }

  /* Keep these out of the scroll area */
  .nav-controls, .progress-container{
    flex: 0 0 auto !important;
  }
</style>
<style id="hard-height-fix">
  :root { --toolbar-h: 64px; } /* updated by your tiny script later */

  /* Stop the document from growing; we’ll scroll inside the panes instead */
  html, body { height: 100dvh !important; overflow: hidden !important; }
  body { padding-top: var(--toolbar-h) !important; }

  /* Pin the app frame between the toolbar and the bottom of the viewport */
  .app-container{
    position: fixed !important;
    top: var(--toolbar-h) !important;
    left: 50% !important;
    transform: translateX(-50%) !important;
    bottom: 0 !important;
    height: auto !important;                /* top+bottom define height */
    width: 100% !important;
    max-width: 1400px !important;
    margin: 0 !important;

    display: grid !important;
    grid-template-columns: 250px 1fr !important;
    overflow: hidden !important;            /* children scroll internally */
    min-height: 0 !important;               /* neutralize earlier min-height */
  }

  /* Sidebar & content always equal the container height */
  .sidebar, .content { height: 100% !important; min-height: 0 !important; }

  /* Sidebar scrolls if the 14 items overflow */
  .sidebar {
    max-height: none !important;
    overflow-y: auto !important;
    -webkit-overflow-scrolling: touch;
  }

  /* Content column: header + scrollable page area + fixed controls */
  .content {
    display: flex !important;
    flex-direction: column !important;
    overflow: hidden !important;
  }

  /* Only this area scrolls in the content pane */
  #page-container, .page-container {
    flex: 1 1 auto !important;
    min-height: 0 !important;
    max-height: none !important;
    overflow-y: auto !important;
    padding-right: 8px !important;
  }

  /* Kill any earlier caps that forced the layout to grow */
  #page-container { max-height: none !important; }
</style>


</head>
<body>

<nav class="toolbar">
  <a class="logo" href="https://publicforumai.com">
    <img alt="Public Forum AI Logo" src="android-chrome-192x192.png"/>
    <span class="logo-text">PublicForumAI©</span>
  </a>
  <div class="nav-links">
    <a href="https://publicforumai.com/flower.html">AI Flow</a>
    <a href="https://publicforumai.com/setup.html">AI Practice Round</a>
    <a href="https://publicforumai.com/casewriter.html">AI Casewriter</a>
    <a href="https://publicforumai.com/new2debate.html">Training Modules</a>
  </div>
  <div id="authSlot">
    <a href="login.html">
      <div class="button signin"><span class="title">SIGN IN</span></div>
    </a>
  </div>
</nav>

  <!-- Main container -->
  <div class="app-container">
    <!-- Sidebar listing modules -->
    <aside class="sidebar">
      <h2>Learning Modules</h2>
      <ul id="module-list" class="module-list"></ul>
    </aside>
    <!-- Content area -->
    <main class="content">
      <div id="module-title" class="content-header">Select a module</div>
      <div id="page-container" class="page-container"></div>
      <!-- Navigation buttons and progress bar -->
      <div class="nav-controls">
        <button id="back-btn" class="nav-button back" disabled>Back</button>
        <button id="next-btn" class="nav-button next" disabled>Next</button>
      </div>
      <div class="progress-container">
        <div id="progress-bar" class="progress-bar"></div>
      </div>
    </main>
  </div>

<script>
  (function(){
    const tb = document.querySelector('nav.toolbar');
    if (tb) {
      const h = tb.getBoundingClientRect().height;
      document.documentElement.style.setProperty('--toolbar-h', h + 'px');
    }
  })();
</script>

  <script>
  // Text and data resources for Module 6
  const m6AffirmativeScript = `Affirmative Case

We affirm.

Plastic overuse has reached a breaking point.
Grant 24 reports, “Only 4% of plastics in the United States were recycled in 2022, while the overall amount of plastic produced reached an all-time high.” Supporting that, Velasquez 23 finds, “Americans created more than 18 million tons of throwaway plastic packaging in 2020 alone.”

Unless we act now, the crisis will worsen. Drayton 23 warns, “Global plastic use could nearly double by 2055 if meaningful restrictions are not introduced.”

That’s why banning single-use plastics solves three urgent issues.

Contention One: Global Waste Dumping

U.S. plastic doesn’t just stay here. Harper 21 explains, “Each year, the United States ships over half a million tons of scrap plastic to developing nations with weak recycling infrastructure.”

International controls haven’t stopped it. Jansen 22 finds, “Despite international treaties designed to curb plastic waste exports, the U.S. continues to send hundreds of millions of pounds abroad, often under mislabeled categories that bypass oversight.”

The result is deadly. Aluko 20 warns, “Toxic fumes from burning plastics in low-income regions contribute to more than 800,000 deaths annually, with children facing the greatest health risks.”

Thus, reducing single-use plastic waste is a moral obligation to prevent exporting harm.

Contention Two: Marine Collapse

Plastics devastate oceans. Chen 23 observes, “Discarded bottles, bags, and straws fragment into microplastics that fish ingest, causing mass starvation and reproductive harm.”

The U.S. is a leading source. Salazar 21 writes, “The U.S. produces more plastic waste per capita than any other country, and over 7 million tons leak into marine environments each year.”

This leads to ecosystem collapse. Lin 20 warns, “By 2030, the volume of microplastics could quadruple, risking the survival of countless marine species.”

The impact is global hunger. Lee 21 highlights, “Seafood provides critical nutrition for 3.1 billion people, especially in coastal nations where alternatives are scarce.”

Without action, banning plastics, billions may lose their main food source.

Contention Three: U.S. Leadership

The U.S. sets the tone for environmental policy. McAdams 22 notes, “When America raised its climate goals in 2021, dozens of countries quickly followed with stronger pledges of their own.”

Yet, on plastics, the U.S. lags. Rowan 21 reports, “Per person, the United States produces more plastic waste annually than China, while having far weaker regulations.”

This matters for climate change. Plastic is fossil-fuel based. Carter 20 finds, “Over 98% of all plastics come directly from oil and gas, and by mid-century, plastic manufacturing alone could account for 15% of global emissions.”

The cost is human lives. Patel 23 calculates, “Every additional tenth of a degree of warming could push another 90 million people toward premature death.”

Thus, U.S. action on plastic sparks international momentum and slows climate collapse.

Conclusion

By stopping single-use plastics, we reduce toxic waste dumping, preserve marine ecosystems, and reinvigorate global climate progress.

For these reasons, we are proud to affirm.`;

  const m6SampleFlow = [
    ['Overview','Ban single-use plastic → stop dumping, protect oceans, lead globally'],
    ['C1 — Claim','US ships scrap plastic abroad'],
    ['C1 — Why','Treaties weak / mislabeled exports bypass rules'],
    ['C1 — Result','Burning toxins → ~800k deaths/yr (children at risk)'],
    ['C2 — Claim','Plastics → microplastics harm fish'],
    ['C2 — Why','US top waste; ~7M tons leak to oceans'],
    ['C2 — Result','Ecosystem collapse → food risk for ~3.1B'],
    ['C3 — Claim','US leadership matters; we lag now'],
    ['C3 — Why','Plastic = oil/gas; big emissions if unchecked'],
    ['C3 — Result','Action lowers warming → fewer premature deaths']
  ];
  /*
    This script defines a simple JavaScript framework to manage
    multi‑page learning modules.  Each module is represented as an
    object with a unique id, display title, reward value, an array
    of page renderers, and a validation function to prevent moving
    forward prematurely.  When the user completes the last page of
    a module, the module’s reward is added to their gem count and
    saved to localStorage.

    The application persists progress in localStorage so that
    returning users retain their gem count and which modules are
    complete.  The gem bar at the bottom updates whenever gems
    change.
  */

  // Utility to safely get and set persistent state
  const AppState = {
    get() {
      const raw = localStorage.getItem('pfai_state');
      try {
        return raw ? JSON.parse(raw) : { gems: 0, modules: {} };
      } catch (e) {
        return { gems: 0, modules: {} };
      }
    },
    save(state) {
      localStorage.setItem('pfai_state', JSON.stringify(state));
    },
    addGems(amount) {
      const state = this.get();
      state.gems += amount;
      this.save(state);
      updateGemBar();
    },
    markModuleComplete(moduleId) {
      const state = this.get();
      if (!state.modules[moduleId]) {
        state.modules[moduleId] = { completed: true };
      } else {
        state.modules[moduleId].completed = true;
      }
      this.save(state);
    },
    isModuleComplete(moduleId) {
      const state = this.get();
      return state.modules[moduleId] && state.modules[moduleId].completed;
    }
  };

  // Update the gem bar at bottom
  function updateGemBar() {
    const state = AppState.get();
    document.getElementById('gem-count').textContent = state.gems;
  }

  // Module definitions
  const modules = [
    {
      id: 'm1',
      title: 'Getting to Know You',
      reward: 10,
      pages: [
        function renderM1P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Welcome to Learn2Debate!</h3>
            <p>We're excited to help you learn debate skills! This short survey will help us understand your experience level so we can provide the best learning experience for you.</p>
            <p><em>Click 'Next' to begin the survey.</em></p>
          `;
          container.appendChild(card);
        },
        function renderM1P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Your Debate Experience</h3>
            <p>Please select the option that best describes your current debate experience level. This will help us recommend the right lessons for you.</p>
          `;
          const options = [
            { label: "Brand New - I'm just starting to learn about debate", value: 'New' },
            { label: 'Beginner - I know basic debate terms and structure', value: 'Beginner' },
            { label: 'Intermediate - I\'ve done some debates before', value: 'Proficient' },
            { label: 'Advanced - I have significant debate experience', value: 'Advanced' },
            { label: 'Expert - I compete regularly at high levels', value: 'Expert' }
          ];
          const group = document.createElement('div');
          group.className = 'options-group';
          options.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm1_experience';
            input.value = opt.value;
            input.onchange = () => {
              m1State.experience = opt.value;
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt.label);
            group.appendChild(label);
          });
          card.appendChild(group);
          container.appendChild(card);
        },
        function renderM1P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>School Debate Program</h3>
            <p>Do you currently participate in debate through your school?</p>
          `;
          const group = document.createElement('div');
          group.className = 'options-group';
          ['Yes','No'].forEach(value => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm1_school';
            input.value = value;
            input.onchange = () => {
              m1State.school = value;
              updateSchoolNameField();
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + value);
            group.appendChild(label);
          });
          card.appendChild(group);
          // conditional school name
          const nameDiv = document.createElement('div');
          nameDiv.style.marginTop = '10px';
          nameDiv.innerHTML = `<label>School name: <input type="text" class="form-input" id="m1_school_name" /></label>`;
          card.appendChild(nameDiv);
          container.appendChild(card);
          function updateSchoolNameField() {
            const show = m1State.school === 'Yes';
            nameDiv.style.display = show ? 'block' : 'none';
          }
          updateSchoolNameField();
        },
        function renderM1P4(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Your Goals</h3>
            <p>Please select the goal you want to achieve by learning debate:</p>
          `;
          const goals = [
            'Improve public speaking',
            'Think critically',
            'Compete in tournaments',
            'For School',
            'Develop leadership skills',
            'Other'
          ];
          const group = document.createElement('div');
          group.className = 'options-group';
          goals.forEach(g => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm1_goal';
            input.value = g;
            input.onchange = () => {
              m1State.goal = g;
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + g);
            group.appendChild(label);
          });
          card.appendChild(group);
          container.appendChild(card);
        },
        function renderM1P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>How You Found Us</h3>
            <p>How did you hear about PublicForumAI.com?</p>
          `;
          const sources = [
            { label:'From a friend or teammate', value:'Friend' },
            { label:'Through my school or teacher', value:'School' },
            { label:'Social media (Instagram, TikTok, etc.)', value:'Social Media' },
            { label:'Internet search (Google, etc.)', value:'Google' },
            { label:'Other way', value:'Other' }
          ];
          const group = document.createElement('div');
          group.className = 'options-group';
          sources.forEach(src => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm1_discovery';
            input.value = src.value;
            input.onchange = () => {
              m1State.discovery = src.value;
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + src.label);
            group.appendChild(label);
          });
          card.appendChild(group);
          container.appendChild(card);
        },
        function renderM1P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Thank You!</h3>
            <p>Thanks for completing our introduction survey!</p>
            <p>You earned ${modules.find(m=>m.id==='m1').reward} gems to get started.</p>
            <div style="font-size:48px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      // Temporary state for storing answers in module 1
      state: { experience:null, school:null, goal:null, discovery:null }
    },
    {
      id: 'm2',
      title: 'Debate Etiquette & Professional Conduct',
      reward: 15,
      pages: [
        function renderM2P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Debate Etiquette & Professional Conduct</h3>
            <p>Professional conduct is just as important as your arguments in debate. Judges notice how you carry yourself, treat your opponents, and respect the process.</p>
            <p>In this module, you'll learn the essential etiquette rules that separate novice debaters from true professionals.</p>
            <h4>Why Etiquette Matters:</h4>
            <ul>
              <li>Creates a positive impression on judges</li>
              <li>Shows respect for your opponents and the activity</li>
              <li>Helps maintain focus on substantive arguments</li>
              <li>Professional behavior can be a tie‑breaker in close rounds</li>
            </ul>
          `;
          container.appendChild(card);
        },
        function renderM2P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Essential Debate Etiquette</h3>
            <p>Key guidelines to remember:</p>
            <ul>
              <li>Stand when giving speeches and during your Crossfire turns</li>
              <li>Face the judge when speaking—don’t lock eyes only on your opponent</li>
              <li>Project your voice clearly so everyone can hear you</li>
              <li>Avoid filler words ("um", "like", "you know") as much as possible</li>
              <li>Dress business casual or formal for tournaments and rounds</li>
              <li>Shake hands (or politely acknowledge) opponents before/after the round</li>
              <li>Thank the judge at the end of the round</li>
              <li>Use professional language; avoid slang/casual expressions</li>
              <li>Take notes during your opponent’s speeches</li>
              <li>Keep materials organized; avoid excessive paper shuffling</li>
            </ul>
          `;
          container.appendChild(card);
        },
        function renderM2P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Dress Code & Professional Appearance</h3>
            <p>Appropriate Tournament Attire:</p>
            <div class="columns" style="display:flex;justify-content:space-between;gap:20px;">
              <div style="flex:1;">
                <h4 style="color:var(--primary-color);">Recommended</h4>
                <ul>
                  <li>Suits or sport coats (optional)</li>
                  <li>Dress shirts / blouses</li>
                  <li>Dress slacks or skirts</li>
                  <li>Closed‑toe dress shoes</li>
                  <li>Conservative colors (navy, black, gray)</li>
                  <li>Business casual: chinos/khakis, collared shirt or blouse, optional blazer, neat flats/loafers</li>
                </ul>
              </div>
              <div style="flex:1;">
                <h4 style="color:var(--secondary-color);">Avoid</h4>
                <ul>
                  <li>Jeans or casual pants (especially ripped/torn)</li>
                  <li>T‑shirts / graphic tees / crop tops</li>
                  <li>Sneakers or sandals</li>
                  <li>Revealing or overly tight clothing</li>
                  <li>Loud patterns or neon brights</li>
                  <li>Hats or caps (indoors)</li>
                  <li>Athletic wear (shorts, leggings, hoodies) during rounds</li>
                </ul>
              </div>
            </div>
            <h4>Scenario:</h4>
            <p>You have a Saturday PF tournament at a high school. Which approach best fits dress expectations?</p>
          `;
          // options for scenario
          const options = [
            'Jeans, sneakers, graphic tee — it\'s the weekend',
            'Business casual (chinos/khakis, collared shirt/blouse, neat shoes), optional blazer',
            'Athletic shorts and a hoodie because it\'s comfortable',
            'Neon T‑shirt to stand out'
          ];
          const group = document.createElement('div');
          group.className = 'options-group';
          const feedback = document.createElement('p');
          feedback.style.fontWeight = 'bold';
          options.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm2_attire';
            input.value = opt;
            input.onchange = () => {
              if(opt.startsWith('Business casual')) {
                feedback.textContent = 'Correct! Business casual is appropriate and professional for most high‑school PF tournaments.';
                feedback.style.color = '#27ae60';
              } else {
                feedback.textContent = 'Consider a professional look that’s comfortable: business‑casual works well. Avoid casual or flashy outfits.';
                feedback.style.color = '#e74c3c';
              }
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            group.appendChild(label);
          });
          card.appendChild(group);
          card.appendChild(feedback);
          container.appendChild(card);
        },
        function renderM2P4(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Crossfire Conduct Scenario</h3>
            <p>Scenario: Your opponent makes a personal comment about your speaking style. How do you respond?</p>
          `;
          const responses = [
            'Ignore the comment and focus on the substantive arguments',
            'Make a similar personal comment about their delivery',
            'Politely redirect to the debate content: “I\'d prefer we focus on the arguments rather than style”',
            'Ask the judge to admonish your opponent for unprofessional behavior'
          ];
          const group = document.createElement('div');
          group.className = 'options-group';
          const feedback = document.createElement('p');
          feedback.style.fontWeight = 'bold';
          responses.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm2_crossfire';
            input.value = opt;
            input.onchange = () => {
              if(opt.startsWith('Politely redirect')) {
                feedback.textContent = 'Correct! This keeps things professional and focused on arguments.';
                feedback.style.color = '#27ae60';
              } else {
                feedback.textContent = 'Aim to de‑escalate and steer back to substance. A polite redirect is best.';
                feedback.style.color = '#e74c3c';
              }
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            group.appendChild(label);
          });
          card.appendChild(group);
          card.appendChild(feedback);
          container.appendChild(card);
        },
        function renderM2P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Interacting with Judges and Staff</h3>
            <p>Guidelines for professional conduct:</p>
            <ul>
              <li>Address judges respectfully (e.g., ‘Judge’ or ‘Judge [Last Name]’ if known).</li>
              <li>Thank judges at the end of the round, regardless of outcome.</li>
              <li>Do not argue with a judge’s decision.</li>
              <li>Be polite to tournament staff and volunteers.</li>
              <li>Arrive early to show respect for everyone's time.</li>
              <li>Follow tournament rules and procedures without complaint.</li>
            </ul>
            <h4>Scenario:</h4>
            <p>The judge votes against you. What should you do immediately after?</p>
          `;
          const options = [
            'Politely thank the judge for their time and leave the room',
            'Ask the judge to reconsider while explaining why you should have won',
            'Publicly complain to your coach about the decision in front of the judge',
            'Post on social media criticizing the judge right after the round'
          ];
          const group = document.createElement('div');
          group.className = 'options-group';
          const feedback = document.createElement('p');
          feedback.style.fontWeight = 'bold';
          options.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm2_judge';
            input.value = opt;
            input.onchange = () => {
              if(opt.startsWith('Politely thank')) {
                feedback.textContent = 'Correct. Professional courtesy matters regardless of outcome.';
                feedback.style.color = '#27ae60';
              } else {
                feedback.textContent = 'Best practice: thank the judge and exit gracefully. Save debriefs for later, privately.';
                feedback.style.color = '#e74c3c';
              }
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            group.appendChild(label);
          });
          card.appendChild(group);
          card.appendChild(feedback);
          container.appendChild(card);
        },
        function renderM2P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Final Review</h3>
            <p>Key etiquette principles to remember:</p>
            <ul>
              <li>Professional appearance creates positive first impressions.</li>
              <li>Clear, respectful communication enhances your credibility.</li>
              <li>Proper Crossfire conduct shows maturity and respect.</li>
              <li>Judge and staff courtesy reflects well on you and your team.</li>
              <li>Good etiquette can be the difference in close decisions.</li>
            </ul>
            <p><em>You’re ready to apply professional etiquette in every round!</em></p>
          `;
          container.appendChild(card);
        },
        function renderM2P7(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          const reward = modules.find(m=>m.id==='m2').reward;
          card.innerHTML = `
            <h3>Module Complete!</h3>
            <p>Congratulations! You’ve mastered Debate Etiquette & Professional Conduct.</p>
            <p>You earned ${reward} gems!</p>
            <div style="font-size:60px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      // simple validation: no early restrictions here
      state: {}
    },
    {
      id: 'm3',
      title: 'What is Debate?',
      reward: 20,
      pages: [
        function renderM3P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>What is Debate?</h3>
            <p>A fast, structured way to argue ideas fairly and clearly. Two sides present claims, reasons, and evidence to persuade a judge. You’ll learn to think critically, speak clearly, and compare which impacts matter most.</p>
            <ul>
              <li>🎯 Make a clear claim (what you want the judge to believe)</li>
              <li>🧠 Give a warrant (why your claim is true)</li>
              <li>📊 Show evidence (proof from credible sources)</li>
              <li>⚖️ Weigh impacts (why your side matters more)</li>
            </ul>
          `;
          container.appendChild(card);
        },
        function renderM3P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Pick a Topic</h3>
            <p>Select one of these debate topics:</p>
          `;
          const topics = ['Pineapple belongs on pizza','Homework should be banned','Cats are better than dogs'];
          const group = document.createElement('div');
          group.className = 'options-group';
          topics.forEach(topic => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm3_topic';
            input.value = topic;
            input.onchange = () => { m3State.topic = topic; };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + topic);
            group.appendChild(label);
          });
          card.appendChild(group);
          container.appendChild(card);
        },
        function renderM3P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Choose Your Side</h3>
            <p>Topic: ${m3State.topic || ''}</p>
          `;
          const group = document.createElement('div');
          group.className = 'options-group';
          [ { text:'Agree (Affirmative)', value:'Aff' }, { text:'Disagree (Negative)', value:'Neg' } ].forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm3_side';
            input.value = opt.value;
            input.onchange = () => { m3State.side = opt.value; };
            label.appendChild(input);
            label.insertAdjacentText('beforeend',' '+opt.text);
            group.appendChild(label);
          });
          card.appendChild(group);
          container.appendChild(card);
        },
        function renderM3P4(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          const sideText = m3State.side === 'Aff' ? 'Agree' : (m3State.side === 'Neg' ? 'Disagree' : '');
          card.innerHTML = `
            <h3>State Your Argument</h3>
            <p>Topic: ${m3State.topic || ''} | Side: ${sideText}</p>
            <p>Give one argument supporting your stance (min 25 characters):</p>
          `;
          const textarea = document.createElement('textarea');
          textarea.rows = 6;
          textarea.oninput = () => {
            m3State.reason = textarea.value.trim();
            updateCount();
          };
          if(m3State.reason) textarea.value = m3State.reason;
          const countLabel = document.createElement('p');
          countLabel.style.fontStyle = 'italic';
          function updateCount() {
            const n = m3State.reason ? m3State.reason.length : 0;
            countLabel.textContent = `Minimum 25 characters (currently: ${n})`;
            countLabel.style.color = n >= 25 ? '#27ae60' : '#e74c3c';
          }
          updateCount();
          card.appendChild(textarea);
          card.appendChild(countLabel);
          container.appendChild(card);
        },
        function renderM3P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          const sideText = m3State.side === 'Aff' ? 'Agree' : 'Disagree';
          card.innerHTML = `
            <h3>Potential Rebuttals</h3>
            <p>Topic: ${m3State.topic || ''} | Your side: ${sideText}</p>
            <p>Example arguments:</p>
          `;
          let lines = [];
          switch(m3State.topic) {
            case 'Pineapple belongs on pizza':
              lines = [ 'Aff: Pineapple adds a sweet note that balances salty toppings.', 'Neg: It changes the traditional savoury profile of pizza.' ];
              break;
            case 'Homework should be banned':
              lines = [ 'Aff: Reduces stress and frees time for sleep & activities.', 'Neg: Provides practice and reinforces classroom learning.' ];
              break;
            case 'Cats are better than dogs':
              lines = [ 'Aff: Lower daily maintenance; more independent.', 'Neg: Dogs are more affectionate and protective.' ];
              break;
            default:
              lines = [ 'Aff: Provide a concrete benefit with a warrant and source.', 'Neg: Undercut assumptions, propose alternatives, challenge evidence.' ];
          }
          const ul = document.createElement('ul');
          lines.forEach(l => {
            const li = document.createElement('li');
            li.textContent = l;
            ul.appendChild(li);
          });
          card.appendChild(ul);
          const tip = document.createElement('p');
          tip.textContent = 'Think about how you would respond in Crossfire or Rebuttal.';
          tip.style.fontStyle = 'italic';
          card.appendChild(tip);
          container.appendChild(card);
        },
        function renderM3P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>The Importance of Evidence</h3>
            <p>In PF, evidence is essential.</p>
            <p><strong>Extreme example:</strong></p>
            <ul>
              <li>Side A cites a credible study claiming the sun is blue (wrong fact).</li>
              <li>Side B says the sun is yellow but provides no sources and never refutes A’s study.</li>
            </ul>
            <p>Who wins? Side A—because they used evidence and Side B didn’t. In real debates, always bring sources and directly answer your opponent’s.</p>
          `;
          container.appendChild(card);
        },
        function renderM3P7(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          const reward = modules.find(m=>m.id==='m3').reward;
          card.innerHTML = `
            <h3>Module Complete!</h3>
            <p>Great work! You’ve finished this module.</p>
            <p>You’ll earn ${reward} gems when you press Next.</p>
            <div style="font-size:60px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      state: { topic: null, side: null, reason: '' }
    },
    /*
      Placeholder modules for the remaining lessons.  The original
      Python program defines additional modules with complex
      interactive elements (ordering tasks, classification quizzes
      and more).  Recreating every behaviour in pure HTML/JS would
      require a significant amount of work.  To honour the
      structure of the original curriculum while keeping this
      conversion manageable, the following modules summarise the
      essentials and award gems upon completion.
    */
    /**
     * Module 4 — What is Public Forum
     *
     * This module recreates the full Public Forum lesson from the original
     * Tkinter program.  It covers everything from key features and the
     * structure of a round to rebuttal/summary writing, crossfire strategies,
     * speech order practice, prep time, judge adaptation, common pitfalls and
     * a final knowledge check.  Each page gates progress via
     * validation in validateCurrentPage().
     */
    {
      id: 'm4',
      title: 'What is Public Forum',
      reward: 30,
      pages: [
        // Page 1: Introduction + quick check
        function renderM4P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Introduction to Public Forum Debate</h3>
            <p>Public Forum is a head‑to‑head team debate where two‑person teams argue a resolution about real‑world issues.</p>
            <p>Key features:</p>
            <ul>
              <li>Teams receive the resolution ahead of time</li>
              <li>Requires research and preparation</li>
              <li>Cases are written in advance and read during the debate</li>
              <li>Emphasises persuasive speaking and evidence‑based arguments</li>
            </ul>
          `;
          // quick check
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = "Quick Check: What's a key feature of Public Forum?";
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'Teams make up arguments on the spot',
            'Cases are written in advance',
            'No evidence is required',
            'Only one speaker per team'
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page1';
            input.value = opt;
            input.onchange = () => {
              m4State.page1 = opt;
              // colour selected text
              quizWrap.querySelectorAll('label').forEach(l => {
                l.style.color = '';
              });
              label.style.color = (opt === 'Cases are written in advance') ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 2: Structure of a round + description of speakers
        function renderM4P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Structure of a Round</h3>
            <p>Teams typically have two speakers.  The first speaker delivers the Case and Summary; the second speaker handles Rebuttal and Final Focus.  Maverick (one debater) does all speeches and usually gets extra prep time.</p>
            <p>Speech Order:</p>
          `;
          const list = document.createElement('ul');
          [
            'Case (4 min) — First Speaker',
            'Rebuttal (4 min) — Second Speaker',
            'Summary (3 min) — First Speaker',
            'Grand Crossfire (3 min) — Both Speakers',
            'Final Focus (2 min) — Second Speaker'
          ].forEach(t => {
            const li = document.createElement('li');
            li.textContent = t;
            list.appendChild(li);
          });
          card.appendChild(list);
          // pill style hints
          const pillWrap = document.createElement('div');
          pillWrap.style.display = 'flex';
          pillWrap.style.flexWrap = 'wrap';
          const createPill = txt => {
            const pill = document.createElement('div');
            pill.style.background = '#f0fdfa';
            pill.style.border = '1px solid rgba(0,0,0,0.1)';
            pill.style.borderRadius = '16px';
            pill.style.padding = '6px 10px';
            pill.style.marginRight = '8px';
            pill.style.marginBottom = '6px';
            pill.style.color = '#0f172a';
            pill.style.fontSize = '0.8rem';
            pill.textContent = txt;
            return pill;
          };
          pillWrap.appendChild(createPill('Prep: 3 min (Maverick: 5)'));
          pillWrap.appendChild(createPill('Two speakers per team'));
          card.appendChild(pillWrap);
          container.appendChild(card);
        },
        // Page 3: Case speech example + quick check
        function renderM4P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>The Case Speech</h3>
            <p><strong>Case (4 min):</strong> Present your main contentions and evidence supporting your side.</p>
            <p>Example case opening:</p>
          `;
          const exText = document.createElement('pre');
          exText.textContent = `"We affirm the resolution 'Social media does more harm than good.' Our first contention is that social media promotes unrealistic beauty standards that harm mental health."`;
          exText.style.background = '#f7fafc';
          exText.style.color = '#1f2937';
          exText.style.padding = '12px';
          exText.style.border = '1px solid rgba(0,0,0,0.1)';
          exText.style.borderRadius = '4px';
          exText.style.whiteSpace = 'pre-wrap';
          card.appendChild(exText);
          // quick check
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'What makes this an effective case opening?';
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'It states the resolution clearly',
            'It presents a specific contention with a claim',
            'It uses emotional language only',
            "It's very short"
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page3';
            input.value = opt;
            input.onchange = () => {
              m4State.page3 = opt;
              quizWrap.querySelectorAll('label').forEach(l => l.style.color = '');
              label.style.color = (opt === 'It presents a specific contention with a claim') ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 4: Rebuttal practice
        function renderM4P4(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>The Rebuttal Speech</h3>
            <p><strong>Rebuttal (4 min):</strong> Respond to the opponent's arguments and reinforce your own case.</p>
            <p>Prompt: “Social media connects people across the world, which is overwhelmingly positive.” Write a short rebuttal.</p>
          `;
          const textarea = document.createElement('textarea');
          textarea.rows = 4;
          textarea.className = 'form-input';
          textarea.placeholder = 'Type your rebuttal here…';
          textarea.oninput = () => {
            m4State.rebuttal = textarea.value.trim();
          };
          card.appendChild(textarea);
          container.appendChild(card);
        },
        // Page 5: Summary practice
        function renderM4P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>The Summary Speech</h3>
            <p><strong>Summary (3 min):</strong> Review the key points and frame why your side is winning.</p>
            <p>Based on these round notes, craft a summary:</p>
            <ul>
              <li>Our contention: Social media promotes unrealistic beauty standards</li>
              <li>Their response: It connects people globally</li>
              <li>Our rebuttal: Connection comes at a mental‑health cost</li>
              <li>Their evidence: Study showing increased communication</li>
              <li>Our evidence: APA study linking social media to depression</li>
            </ul>
          `;
          const textarea = document.createElement('textarea');
          textarea.rows = 5;
          textarea.className = 'form-input';
          textarea.placeholder = 'Write your summary here…';
          textarea.oninput = () => {
            m4State.summary = textarea.value.trim();
          };
          card.appendChild(textarea);
          container.appendChild(card);
        },
        // Page 6: Grand Crossfire strategies + quick check
        function renderM4P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Grand Crossfire</h3>
            <p><strong>Grand Crossfire (3 min):</strong> All debaters ask and answer questions to clarify and challenge arguments.</p>
            <p>Crossfire Strategies:</p>
            <ul>
              <li>Ask clarifying questions about opponent's arguments</li>
              <li>Challenge the validity of their evidence</li>
              <li>Expose contradictions in their position</li>
              <li>Use questions to set up your next speech</li>
            </ul>
          `;
          // quick check
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'They cite a study from 2010. Best approach?';
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'Ignore the study completely',
            "Challenge the study's relevance due to its age",
            'Attack the researcher personally',
            'Change the subject entirely'
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page6';
            input.value = opt;
            input.onchange = () => {
              m4State.page6 = opt;
              quizWrap.querySelectorAll('label').forEach(l => l.style.color = '');
              label.style.color = (opt === "Challenge the study's relevance due to its age") ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 7: Final Focus best practice + quick check
        function renderM4P7(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Final Focus</h3>
            <p><strong>Final Focus (2 min):</strong> Highlight the crucial arguments and explain clearly why you win.</p>
          `;
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'Best practice for Final Focus:';
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'Introduce brand‑new arguments',
            'Select the most important voting issues and weigh clearly',
            'Re‑read your entire case',
            'Focus on speaking speed over clarity'
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page7';
            input.value = opt;
            input.onchange = () => {
              m4State.page7 = opt;
              quizWrap.querySelectorAll('label').forEach(l => l.style.color = '');
              label.style.color = (opt === 'Select the most important voting issues and weigh clearly') ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 8: Order exercise
        function renderM4P8(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Round Overview</h3>
            <p>Arrange the speeches in the correct order (1 → 5).</p>
          `;
          // display correct order with pills for reference
          const ref = document.createElement('div');
          ['Case (4)', 'Rebuttal (4)', 'Summary (3)', 'Grand Crossfire (3)', 'Final Focus (2)'].forEach(item => {
            const pill = document.createElement('span');
            pill.style.background = '#f0fdfa';
            pill.style.border = '1px solid rgba(0,0,0,0.1)';
            pill.style.borderRadius = '16px';
            pill.style.padding = '4px 8px';
            pill.style.marginRight = '6px';
            pill.style.marginBottom = '6px';
            pill.style.display = 'inline-block';
            pill.style.fontSize = '0.8rem';
            pill.style.color = '#0f172a';
            pill.textContent = item;
            ref.appendChild(pill);
          });
          card.appendChild(ref);
          const form = document.createElement('div');
          form.style.marginTop = '12px';
          const base = ['Case', 'Rebuttal', 'Summary', 'Grand Crossfire', 'Final Focus'];
          m4State.speechOrder = m4State.speechOrder || ['', '', '', '', ''];
          // shuffle options for dropdown values
          const shuffled = base.slice().sort(() => Math.random() - 0.5);
          m4State.speechOrderCorrect = m4State.speechOrderCorrect || false;
          // feedback label
          const feedback = document.createElement('p');
          feedback.style.marginTop = '6px';
          feedback.style.fontWeight = 'bold';
          feedback.style.color = '#065f46';
          function buildSelect(idx) {
            const select = document.createElement('select');
            select.className = 'form-input';
            select.style.maxWidth = '200px';
            const defaultOpt = document.createElement('option');
            defaultOpt.value = '';
            defaultOpt.textContent = 'Select…';
            select.appendChild(defaultOpt);
            shuffled.forEach(opt => {
              const option = document.createElement('option');
              option.value = opt;
              option.textContent = opt;
              select.appendChild(option);
            });
            select.value = m4State.speechOrder[idx] || '';
            select.onchange = () => {
              m4State.speechOrder[idx] = select.value;
            };
            return select;
          }
          for (let i = 0; i < 5; i++) {
            const row = document.createElement('div');
            row.style.display = 'flex';
            row.style.alignItems = 'center';
            row.style.marginBottom = '6px';
            const num = document.createElement('span');
            num.textContent = (i + 1) + '.';
            num.style.width = '20px';
            row.appendChild(num);
            row.appendChild(buildSelect(i));
            form.appendChild(row);
          }
          const submit = document.createElement('button');
          submit.textContent = 'Check Order (Submit)';
          submit.className = 'nav-button next';
          submit.style.marginTop = '8px';
          submit.onclick = () => {
            // ensure all selected
            if (m4State.speechOrder.some(v => !v)) {
              feedback.style.color = 'red';
              feedback.textContent = 'Fill all 5 slots.';
              return;
            }
            // check uniqueness
            const set = new Set(m4State.speechOrder);
            if (set.size !== 5) {
              feedback.style.color = 'red';
              feedback.textContent = 'Each speech can be used once.';
              return;
            }
            const correct = ['Case', 'Rebuttal', 'Summary', 'Grand Crossfire', 'Final Focus'];
            if (m4State.speechOrder.join(',') === correct.join(',')) {
              feedback.style.color = 'green';
              feedback.textContent = 'Correct! ✓';
              m4State.speechOrderCorrect = true;
            } else {
              feedback.style.color = 'red';
              feedback.textContent = 'Not quite — try again.';
              m4State.speechOrderCorrect = false;
            }
          };
          form.appendChild(submit);
          form.appendChild(feedback);
          card.appendChild(form);
          container.appendChild(card);
        },
        // Page 9: Prep Time Strategy
        function renderM4P9(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Prep Time Strategy</h3>
            <p>Teams get 3 minutes of prep time to use strategically throughout the round.</p>
          `;
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'After their rebuttal, you have 2 minutes of prep; your summary is next. Best use?';
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'Plan responses to their rebuttal arguments',
            'Practice your delivery for the summary',
            'Prepare questions for grand crossfire',
            'Take a break to clear your mind'
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page9';
            input.value = opt;
            input.onchange = () => {
              m4State.page9 = opt;
              quizWrap.querySelectorAll('label').forEach(l => l.style.color = '');
              label.style.color = (opt === 'Plan responses to their rebuttal arguments') ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 10: Flowing — explanation
        function renderM4P10(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Flowing — Structured Notes</h3>
            <p>Flowing is the way debaters track arguments across speeches so nothing gets dropped. You’ll learn the full, hands‑on method in Module 6.</p>
          `;
          container.appendChild(card);
        },
        // Page 11: Judge adaptation
        function renderM4P11(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Judge Adaptation</h3>
            <p>Great debaters adapt style and content to different judge preferences.</p>
            <p>Judge Types:</p>
            <ul>
              <li>Flow Judge: Technical, line‑by‑line</li>
              <li>Lay Judge: Clear, persuasive, story‑driven</li>
              <li>Parent Judge: Politeness, real‑world examples</li>
              <li>Tech Judge: Evidence comparison, specificity</li>
            </ul>
          `;
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'You have a Parent Judge. What approach works best?';
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'Use highly technical debate jargon',
            'Focus on clear, real‑world examples',
            'Speed through your arguments quickly',
            'Focus only on evidence comparison'
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page11';
            input.value = opt;
            input.onchange = () => {
              m4State.page11 = opt;
              quizWrap.querySelectorAll('label').forEach(l => l.style.color = '');
              label.style.color = (opt === 'Focus on clear, real‑world examples') ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 12: Common pitfalls
        function renderM4P12(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Common Pitfalls to Avoid</h3>
            <p>Even experienced debaters make these mistakes — avoid them!</p>
          `;
          const quizWrap = document.createElement('div');
          quizWrap.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'Final focus fixates on a trivial point, ignoring main voting issues. Identify the pitfall:';
          q.style.fontWeight = 'bold';
          quizWrap.appendChild(q);
          const opts = [
            'Spreading (speaking too fast)',
            'Dropping arguments (not responding to key points)',
            'Going for trivial points instead of winning issues',
            'Using inappropriate evidence'
          ];
          opts.forEach(opt => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm4_page12';
            input.value = opt;
            input.onchange = () => {
              m4State.page12 = opt;
              quizWrap.querySelectorAll('label').forEach(l => l.style.color = '');
              label.style.color = (opt === 'Going for trivial points instead of winning issues') ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quizWrap.appendChild(label);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 13: Final Review Quiz
        function renderM4P13(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Review & Practice</h3>
            <p>Test your knowledge. Answer all questions correctly to finish.</p>
          `;
          const quizWrap = document.createElement('div');
          quizWrap.style.display = 'flex';
          quizWrap.style.flexDirection = 'column';
          quizWrap.style.gap = '16px';
          const questions = [
            { q: 'How long is the summary speech?', opts: ['2 minutes','3 minutes','4 minutes','5 minutes'], correct: '3 minutes', key: 'q1' },
            { q: 'What is a maverick in PF debate?', opts: ['A team that speaks too fast','A single debater doing both speeches','A team that doesn\'t use evidence','A judge who gives low points'], correct: 'A single debater doing both speeches', key: 'q2' },
            { q: 'How much prep time does a normal team get?', opts: ['1 minute','2 minutes','3 minutes','5 minutes'], correct: '3 minutes', key: 'q3' }
          ];
          questions.forEach(item => {
            const block = document.createElement('div');
            const prompt = document.createElement('p');
            prompt.textContent = item.q;
            prompt.style.fontWeight = 'bold';
            block.appendChild(prompt);
            item.opts.forEach(opt => {
              const label = document.createElement('label');
              const input = document.createElement('input');
              input.type = 'radio';
              input.name = 'm4_final_' + item.key;
              input.value = opt;
              input.onchange = () => {
                m4State.finalAnswers = m4State.finalAnswers || {};
                m4State.finalAnswers[item.key] = opt;
                // color selected answer
                block.querySelectorAll('label').forEach(l => l.style.color = '');
                label.style.color = (opt === item.correct) ? 'green' : 'red';
              };
              label.appendChild(input);
              label.insertAdjacentText('beforeend', ' ' + opt);
              block.appendChild(label);
            });
            quizWrap.appendChild(block);
          });
          card.appendChild(quizWrap);
          container.appendChild(card);
        },
        // Page 14: Completion page
        function renderM4P14(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          let score = 0;
          const finals = m4State.finalAnswers || {};
          if (finals.q1 === '3 minutes') score++;
          if (finals.q2 === 'A single debater doing both speeches') score++;
          if (finals.q3 === '3 minutes') score++;
          card.innerHTML = `
            <h3>Module Complete!</h3>
            <p>Congratulations! You've completed the Public Forum module.</p>
            <p>Final Quiz Score: ${score}/3</p>
            <p>You've earned ${modules.find(m=>m.id==='m4').reward} gems!</p>
            <div style="font-size:48px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      state: {}
    },

    /**
     * Module 5 — Crossfire
     *
     * This module covers crossfire strategy and practice.  It includes
     * multiple classification exercises and instant feedback.  Learners must
     * achieve perfect scores on classification and best‑practice quizzes to
     * move forward.
     */
    {
      id: 'm5',
      title: 'Crossfire',
      reward: 15,
      pages: [
        // Page 1: What is crossfire + quick check
        function renderM5P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>What is Crossfire?</h3>
            <p>Crossfire is the Q&A part of the round. One person from each team asks and answers questions.</p>
            <p>Why it matters: you get clarity, poke holes, and earn small “yes” answers that help you win.</p>
            <p>Timing:</p>
            <ul>
              <li>Crossfire: 2 minutes — happens twice (first speakers after Case, second speakers after Rebuttal).</li>
              <li>Grand Crossfire: 3 minutes — near the end, all four debaters participate together.</li>
            </ul>
            <p>How it feels: fast but polite. Ask short, focused questions. Don’t give speeches; get answers.</p>
            <p>Order of Speeches:</p>
          `;
          const list = document.createElement('ul');
          [
            'Case (First Speaker) → Crossfire (First Speakers)',
            'Rebuttal (Second Speaker) → Crossfire (Second Speakers)',
            'Summary (First Speaker) → Grand Crossfire (Both Speakers)',
            'Final Focus (Second Speaker)'
          ].forEach(t => {
            const li = document.createElement('li');
            li.textContent = t;
            list.appendChild(li);
          });
          card.appendChild(list);
          // quick check: who asks first question
          const quiz = document.createElement('div');
          quiz.className = 'options-group';
          const q = document.createElement('p');
          q.textContent = 'Quick Check: Who usually asks the first question in Crossfire?';
          q.style.fontWeight = 'bold';
          quiz.appendChild(q);
          const opts = ['The team that spoke first','The team with fewer arguments','Whoever raises their hand'];
          opts.forEach((opt, idx) => {
            const label = document.createElement('label');
            const input = document.createElement('input');
            input.type = 'radio';
            input.name = 'm5_page1';
            input.value = idx;
            input.onchange = () => {
              m5State.page1 = idx;
              quiz.querySelectorAll('label').forEach(l => l.style.color = '');
              // correct answer is index 0
              label.style.color = (idx === 0) ? 'green' : 'red';
            };
            label.appendChild(input);
            label.insertAdjacentText('beforeend', ' ' + opt);
            quiz.appendChild(label);
          });
          card.appendChild(quiz);
          container.appendChild(card);
        },
        // Page 2: Informative vs Trap — simple explanation + quick check
        function renderM5P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Informative vs Trap</h3>
            <p>Informative questions are honest clarifications. They ask for facts, links, numbers, or sources.</p>
            <p>Trap questions politely expose a problem. They make your opponent admit a limit, condition, or mistake.</p>
            <p>Examples:</p>
            <ul>
              <li>Informative: “Which year does your evidence cover?”</li>
              <li>Trap: “Would you agree your impact needs three things to happen first?”</li>
              <li>Informative: “Is your source peer‑reviewed or a blog?”</li>
            </ul>
            <p>Quick Check — mark each one Informative or Trap. All three must be correct to continue.</p>
          `;
          // classification items
          const grid = document.createElement('div');
          grid.style.display = 'flex';
          grid.style.flexDirection = 'column';
          grid.style.gap = '12px';
          // Define classification items.  The `ok` value indicates which button
          // is correct: 0 for "Informative", 1 for "Trap".  The original
          // version had these backwards, so they have been flipped here.
          const items = [
            { text: 'Which year does your evidence cover?', ok: 0 }, // Informative
            { text: 'Would you agree your impact needs three things to happen first?', ok: 1 }, // Trap
            { text: 'Is your source peer‑reviewed or a blog?', ok: 0 } // Informative
          ];
          m5State.introItems = [];
          items.forEach((item, idx) => {
            const row = document.createElement('div');
            const prompt = document.createElement('p');
            prompt.textContent = `${idx+1}. ${item.text}`;
            prompt.style.margin = '0';
            row.appendChild(prompt);
            const btns = document.createElement('div');
            btns.style.display = 'flex';
            btns.style.gap = '10px';
            const varObj = { value: -1, ok: item.ok, rowRef: row };
            function onPick(val) {
              // record the chosen value and update row styling
              varObj.value = val;
              const correct = (val === item.ok);
              // Indicate correctness with a coloured left border instead of filling the row. Keep
              // a dark background and white text to avoid obscuring content.
              row.style.background = '';
              row.style.borderLeft = correct ? '6px solid #16a34a' : '6px solid #dc2626';
              row.style.color = '#ffffff';
              updateIntroStatus();
            }
            ['Informative','Trap'].forEach((labelTxt, val) => {
              const b = document.createElement('button');
              b.textContent = labelTxt;
              b.className = 'nav-button next';
              b.style.padding = '4px 8px';
              b.onclick = () => onPick(val);
              btns.appendChild(b);
            });
            row.appendChild(btns);
            grid.appendChild(row);
            m5State.introItems.push(varObj);
          });
          const status = document.createElement('p');
          status.textContent = '0/3 correct';
          status.style.fontWeight = 'bold';
          status.style.marginTop = '8px';
          function updateIntroStatus() {
            let correct = 0;
            m5State.introItems.forEach(it => {
              if (it.value !== -1) {
                if ((it.value === 1 && it.ok === 1) || (it.value === 0 && it.ok === 0)) {
                  correct++;
                }
              }
            });
            m5State.introCorrect = correct;
            status.textContent = `${correct}/3 correct`;
            status.style.color = (correct === 3) ? '#065f46' : '';
          }
          card.appendChild(grid);
          card.appendChild(status);
          container.appendChild(card);
        },
        // Page 3: Question Classifier (6 items) — must be perfect
        function renderM5P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Question Classifier</h3>
            <p>Mark each question type as Informative or Trap. All must be correct to continue.</p>
          `;
          const grid = document.createElement('div');
          grid.style.display = 'flex';
          grid.style.flexDirection = 'column';
          grid.style.gap = '12px';
          // Invert ok values so 0 corresponds to "Informative" and 1 corresponds to "Trap"
          const items = [
            { text: 'Can you walk me through how your evidence proves the final result?', ok: 0 },
            { text: 'If your plan is so great, why did outcomes get worse last year?', ok: 1 },
            { text: 'Which study has the larger sample size, yours or ours?', ok: 0 },
            { text: 'Isn’t it true your source is from a blog, not a journal?', ok: 1 },
            { text: 'What specific time frame does your evidence cover?', ok: 0 },
            { text: 'Would you agree your impact only happens if three unlikely things occur?', ok: 1 }
          ];
          m5State.classifyItems = [];
          items.forEach((item, idx) => {
            const row = document.createElement('div');
            const prompt = document.createElement('p');
            prompt.textContent = `${idx+1}. ${item.text}`;
            prompt.style.margin = '0';
            row.appendChild(prompt);
            const btns = document.createElement('div');
            btns.style.display = 'flex';
            btns.style.gap = '10px';
            const varObj = { value: -1, ok: item.ok, rowRef: row };
            function onPick(val) {
              varObj.value = val;
              const correct = (val === item.ok);
              // Indicate correctness with a coloured left border instead of filling the row.
              row.style.background = '';
              row.style.borderLeft = correct ? '6px solid #16a34a' : '6px solid #dc2626';
              row.style.color = '#ffffff';
              updateClassifyStatus();
            }
            ['Informative','Trap'].forEach((labelTxt, val) => {
              const b = document.createElement('button');
              b.textContent = labelTxt;
              b.className = 'nav-button next';
              b.style.padding = '4px 8px';
              b.onclick = () => onPick(val);
              btns.appendChild(b);
            });
            row.appendChild(btns);
            grid.appendChild(row);
            m5State.classifyItems.push(varObj);
          });
          const status = document.createElement('p');
          status.textContent = '0/6 correct';
          status.style.fontWeight = 'bold';
          status.style.marginTop = '8px';
          function updateClassifyStatus() {
            let correct = 0;
            m5State.classifyItems.forEach(it => {
              if (it.value !== -1) {
                if ((it.value === 1 && it.ok === 1) || (it.value === 0 && it.ok === 0)) {
                  correct++;
                }
              }
            });
            m5State.classifyCorrect = correct;
            status.textContent = `${correct}/6 correct`;
            status.style.color = (correct === 6) ? '#065f46' : '';
          }
          card.appendChild(grid);
          card.appendChild(status);
          container.appendChild(card);
        },
        // Page 4: Listening & Responding (best follow‑up) — must be perfect
        function renderM5P4(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Listening & Responding</h3>
            <p>Pick the best follow‑up (Green = best). All must be correct.</p>
          `;
          const qdata = [
            { prompt: 'They claim their study proves nationwide impact, but it’s from one city.', choices: ['Ask how one city generalizes to the whole country','Argue your impacts are bigger','Read your whole card again'], ok: 0 },
            { prompt: 'They say turnout rises, but never give a number.', choices: ['Ask for the exact percentage increase and the time frame','Say “that’s wrong” and move on','Explain your framework again'], ok: 0 },
            { prompt: 'They dodge your link question.', choices: ['Repeat the question simply and ask for a “yes” or “no”','Change topics','Read new offense'], ok: 0 }
          ];
          m5State.quizItems = [];
          qdata.forEach((item, idx) => {
            const box = document.createElement('div');
            box.style.marginBottom = '12px';
            const prompt = document.createElement('p');
            prompt.textContent = `${idx+1}. ${item.prompt}`;
            prompt.style.fontWeight = 'bold';
            box.appendChild(prompt);
            const varObj = { value: -1, ok: item.ok };
            const rbs = [];
            function onPick(val) {
              varObj.value = val;
              rbs.forEach((rb, i) => {
                rb.style.background = '';
              });
              // reset all backgrounds and text colors
              rbs.forEach(rb => {
                rb.style.background = '';
                rb.style.color = '';
              });
              // apply high‑contrast colouring
              if (val === item.ok) {
                rbs[val].style.background = '#14532d';
              } else {
                rbs[val].style.background = '#7f1d1d';
              }
              rbs[val].style.color = '#ffffff';
              updateQuizStatus();
            }
            item.choices.forEach((choice, ci) => {
              const rb = document.createElement('div');
              rb.style.cursor = 'pointer';
              rb.style.padding = '4px 6px';
              rb.textContent = choice;
              rb.onclick = () => onPick(ci);
              rbs.push(rb);
              box.appendChild(rb);
            });
            m5State.quizItems.push(varObj);
            card.appendChild(box);
          });
          const status = document.createElement('p');
          status.textContent = '0/3 correct';
          status.style.fontWeight = 'bold';
          status.style.marginTop = '8px';
          function updateQuizStatus() {
            let correct = 0;
            m5State.quizItems.forEach((it, index) => {
              if (it.value === qdata[index].ok) correct++;
            });
            m5State.quizScore = correct;
            status.textContent = `${correct}/3 correct`;
            status.style.color = (correct === 3) ? '#065f46' : '';
          }
          card.appendChild(status);
          container.appendChild(card);
        },
        // Page 5: Control the Floor (Good vs Bad tactics) — must be perfect
        function renderM5P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Control the Floor</h3>
            <p>Mark each tactic as Good or Bad practice. All must be correct.</p>
          `;
          // Flip ok values so 0 corresponds to "Good" and 1 to "Bad".  The
          // original mapping was backwards because the button order assigns 0
          // to "Good" and 1 to "Bad".
          const items = [
            { text: 'Ask multi‑part questions to eat up time.', ok: 1 },
            { text: 'Politely cut off speeches: “Thanks — just to clarify…”', ok: 0 },
            { text: 'Argue instead of asking a question.', ok: 1 },
            { text: 'Repeat the question if they dodge it.', ok: 0 },
            { text: 'Use exact words: who, when, how many, which source?', ok: 0 },
            { text: 'Accuse them of lying.', ok: 1 }
          ];
          m5State.goodBadItems = [];
          items.forEach((item, idx) => {
            const row = document.createElement('div');
            row.style.marginBottom = '10px';
            const prompt = document.createElement('p');
            prompt.textContent = `${idx+1}. ${item.text}`;
            prompt.style.margin = '0';
            row.appendChild(prompt);
            const btns = document.createElement('div');
            btns.style.display = 'flex';
            btns.style.gap = '10px';
            const varObj = { value: -1, ok: item.ok };
            function onPick(val) {
              varObj.value = val;
              const correct = (val === item.ok);
              // Use a coloured left border to signal correctness without obscuring the row.
              row.style.background = '';
              row.style.borderLeft = correct ? '6px solid #16a34a' : '6px solid #dc2626';
              row.style.color = '#ffffff';
              updateGoodBadStatus();
            }
            ['Good','Bad'].forEach((labelTxt, val) => {
              const b = document.createElement('button');
              b.textContent = labelTxt;
              b.className = 'nav-button next';
              b.style.padding = '4px 8px';
              b.onclick = () => onPick(val);
              btns.appendChild(b);
            });
            row.appendChild(btns);
            m5State.goodBadItems.push(varObj);
            card.appendChild(row);
          });
          const status = document.createElement('p');
          status.textContent = '0/6 correct';
          status.style.fontWeight = 'bold';
          status.style.marginTop = '8px';
          function updateGoodBadStatus() {
            let correct = 0;
            m5State.goodBadItems.forEach((it, index) => {
              if (it.value !== -1) {
                if ((it.value === 1 && items[index].ok === 1) || (it.value === 0 && items[index].ok === 0)) correct++;
              }
            });
            m5State.goodBadScore = correct;
            status.textContent = `${correct}/6 correct`;
            status.style.color = (correct === 6) ? '#065f46' : '';
          }
          card.appendChild(status);
          container.appendChild(card);
        },
        // Page 6: Crossfire playbook / wrap up reading
        function renderM5P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Crossfire Playbook</h3>
            <p>Congratulations on mastering the classification exercises! Here are a few additional tips to keep in mind during crossfire:</p>
            <ul>
              <li>Always listen carefully so you can ask precise, relevant questions.</li>
              <li>Keep your questions short and focused on exposing weaknesses in their case.</li>
              <li>If your opponent dodges, politely repeat the question and push for a clear answer.</li>
              <li>Avoid being combative — respect earns points with judges.</li>
              <li>Use your prep time to plan which arguments you’ll press in crossfire.</li>
            </ul>
            <p>When you’re ready, click Finish to complete this module and earn your gems.</p>
          `;
          container.appendChild(card);
        },
        // Page 7: Completion
        function renderM5P7(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Module Complete!</h3>
            <p>Great job completing the Crossfire module!</p>
            <p>You've earned ${modules.find(m=>m.id==='m5').reward} gems!</p>
            <div style="font-size:48px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      state: {}
    },

    /**
     * Module 6 — Flowing
     *
     * This module teaches how to flow (take structured notes).  It includes
     * an introduction, a practice table where learners enter notes, the full
     * affirmative script, a sample flow answer key, a multiple‑choice quiz
     * on flowing best‑practices, and a completion page.  Progress is gated
     * on the number of notes filled in the practice table and achieving a
     * perfect score on the quiz.
     */
    {
      id: 'm6',
      title: 'Flowing',
      reward: 20,
      pages: [
        // Page 1: Introduction to Flowing
        function renderM6P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>What is Flowing?</h3>
            <p>Flowing is the way debaters keep track of arguments across speeches. It ensures that no argument is dropped and helps you line up responses in order.</p>
            <p>When done well, a flow lets you see at a glance which side wins each contention and why.</p>
          `;
          container.appendChild(card);
        },
        // Page 2: Practice Flow Table
        function renderM6P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Practice: Take Notes</h3>
            <p>Below is a table of parts (Overview, C1 Claim, etc.). In the right column, type short notes for each part of the example case. Fill at least four cells with non‑empty notes to continue.</p>
          `;
          // create table
          const table = document.createElement('table');
          table.style.width = '100%';
          table.style.borderCollapse = 'collapse';
          const parts = ['Overview','C1 — Claim','C1 — Why','C1 — Result','C2 — Claim','C2 — Why','C2 — Result','C3 — Claim','C3 — Why','C3 — Result'];
          m6State.practiceRows = m6State.practiceRows || parts.map(() => '');
          parts.forEach((part, idx) => {
            const row = document.createElement('tr');
            const col1 = document.createElement('td');
            col1.textContent = part;
            col1.style.border = '1px solid rgba(255,255,255,0.2)';
            col1.style.padding = '6px';
            const col2 = document.createElement('td');
            col2.style.border = '1px solid rgba(255,255,255,0.2)';
            col2.style.padding = '0';
            const input = document.createElement('input');
            input.type = 'text';
            input.className = 'form-input';
            input.style.border = 'none';
            input.style.width = '100%';
            input.style.height = '32px';
            input.placeholder = 'Write here';
            input.value = m6State.practiceRows[idx] || '';
            input.oninput = () => {
              m6State.practiceRows[idx] = input.value.trim();
            };
            col2.appendChild(input);
            row.appendChild(col1);
            row.appendChild(col2);
            table.appendChild(row);
          });
          card.appendChild(table);
          /*
            Provide quick access to the full affirmative script while taking notes.
            Users previously had to navigate to the next page to see the reference case,
            which made it impossible to write notes side‑by‑side.  Add a toggle
            that reveals the full script on demand.  The script will be hidden by
            default and can be shown or hidden via a button.  The content area
            scrolls independently so it doesn’t overwhelm the table.
          */
          const refBtn = document.createElement('button');
          refBtn.className = 'primary-btn';
          refBtn.textContent = 'Show reference case';
          refBtn.style.marginTop = '12px';
          const refDiv = document.createElement('div');
          refDiv.style.display = 'none';
          refDiv.style.marginTop = '10px';
          refDiv.style.maxHeight = '220px';
          refDiv.style.overflowY = 'auto';
          refDiv.style.padding = '8px';
          refDiv.style.border = '1px solid rgba(255,255,255,0.2)';
          refDiv.style.borderRadius = '6px';
          // split the affirmative script by paragraphs for readability
          m6AffirmativeScript.split('\n\n').forEach(par => {
            const p = document.createElement('p');
            p.textContent = par.trim();
            refDiv.appendChild(p);
          });
          refBtn.onclick = () => {
            const visible = refDiv.style.display === 'block';
            refDiv.style.display = visible ? 'none' : 'block';
            refBtn.textContent = visible ? 'Show reference case' : 'Hide reference case';
          };
          card.appendChild(refBtn);
          card.appendChild(refDiv);
          container.appendChild(card);
        },
        // Page 3: Full Script (Affirmative case)
        function renderM6P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          const paragraphs = m6AffirmativeScript.split('\n\n');
          card.innerHTML = `<h3>Affirmative Case Script</h3>`;
          paragraphs.forEach(p => {
            const para = document.createElement('p');
            para.textContent = p;
            card.appendChild(para);
          });
          container.appendChild(card);
        },
        // Page 4: Sample Flow (Answer Key)
        function renderM6P4(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Sample Flow (Answer Key)</h3>
            <p>Here’s one clear way to flow the script. Notice short phrases and rows line up:</p>
          `;
          const table = document.createElement('table');
          table.style.width = '100%';
          table.style.borderCollapse = 'collapse';
          m6SampleFlow.forEach(([part, notes]) => {
            const row = document.createElement('tr');
            const c1 = document.createElement('td');
            c1.textContent = part;
            c1.style.border = '1px solid rgba(255,255,255,0.2)';
            c1.style.padding = '6px';
            const c2 = document.createElement('td');
            c2.textContent = notes;
            c2.style.border = '1px solid rgba(255,255,255,0.2)';
            c2.style.padding = '6px';
            row.appendChild(c1);
            row.appendChild(c2);
            table.appendChild(row);
          });
          card.appendChild(table);
          container.appendChild(card);
        },
        // Page 5: Flowing Quiz
        function renderM6P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Flowing Check‑in</h3>
            <p>Answer these questions about flowing. All must be correct to finish.</p>
          `;
          const qdata = [
            { prompt: 'Why take notes while they talk?', choices: ['So you remember key points later','To copy full sentences neatly','To ignore what you disagree with'], ok: 0 },
            { prompt: 'How should your notes look?', choices: ['Short phrases','Long paragraphs','Only quotes'], ok: 0 },
            { prompt: 'Where do you place answers to a point?', choices: ['Anywhere','Right under that same point','On a new page'], ok: 1 },
            { prompt: 'What does lining up ideas do?', choices: ['Makes responses easy to find','Makes the page pretty','Nothing'], ok: 0 },
            { prompt: 'What should you mark with a star?', choices: ['The key idea you plan to win on','Random facts','Names of authors'], ok: 0 },
            { prompt: 'What’s the goal at the end?', choices: ['Show what matters most and why you win it','Read everything again','Add new points'], ok: 0 }
          ];
          m6State.quizItems = [];
          qdata.forEach((item, idx) => {
            const block = document.createElement('div');
            block.style.marginBottom = '14px';
            const prompt = document.createElement('p');
            prompt.textContent = `${idx+1}. ${item.prompt}`;
            prompt.style.fontWeight = 'bold';
            block.appendChild(prompt);
            const varObj = { value: -1, ok: item.ok };
            const rbs = [];
            function onPick(val) {
              varObj.value = val;
              // reset all options
              rbs.forEach((el) => {
                el.style.background = '';
                el.style.borderLeft = '';
                el.style.color = '';
              });
              // apply a coloured left border instead of a full highlight.  Keep dark background for all options.
              if (val === item.ok) {
                rbs[val].style.background = '';
                rbs[val].style.borderLeft = '6px solid #16a34a';
              } else {
                rbs[val].style.background = '';
                rbs[val].style.borderLeft = '6px solid #dc2626';
              }
              rbs[val].style.color = '#ffffff';
              updateQuizStatus();
            }
            item.choices.forEach((choice, ci) => {
              const optEl = document.createElement('div');
              optEl.textContent = choice;
              optEl.style.cursor = 'pointer';
              optEl.style.padding = '4px 6px';
              optEl.onclick = () => onPick(ci);
              rbs.push(optEl);
              block.appendChild(optEl);
            });
            m6State.quizItems.push(varObj);
            card.appendChild(block);
          });
          const status = document.createElement('p');
          status.textContent = '0/6 correct';
          status.style.fontWeight = 'bold';
          function updateQuizStatus() {
            let correct = 0;
            m6State.quizItems.forEach((it, index) => {
              if (it.value === qdata[index].ok) correct++;
            });
            m6State.quizCorrect = correct;
            status.textContent = `${correct}/6 correct`;
            status.style.color = (correct === 6) ? '#065f46' : '';
          }
          card.appendChild(status);
          container.appendChild(card);
        },
        // Page 6: Completion
        function renderM6P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Module Complete!</h3>
            <p>Great job completing the Flowing module!</p>
            <p>You've earned ${modules.find(m=>m.id==='m6').reward} gems!</p>
            <div style="font-size:48px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      state: {}
    },
    {
      id: 'm7',
      title: 'Prep for a Debate Round',
      reward: 40,
      pages: [
        // Page 1: Prep Steps
        function renderM7P1(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Prep for a Debate Round</h3>
            <p>Follow these steps to write a contention for your case. Keep it simple and focused.</p>
          `;
          const list = document.createElement('ol');
          list.style.paddingLeft = '20px';
          const steps = [
            {t:'Read the resolution slowly',s:'Underline the action and who does it.'},
            {t:'Pick a clear claim',s:'One sentence: what should the judge believe?'},
            {t:'Add a warrant',s:'Why is your claim true? The logic in one or two lines.'},
            {t:'Bring evidence',s:'Credible source that supports your claim.'},
            {t:'Weigh the impact',s:'Explain why your result matters most.'},
            {t:'Prepare blocks',s:'Write short answers to common opponent claims.'},
            {t:'Time your parts',s:'Practice saying the key lines within your speech time.'}
          ];
          steps.forEach((step, idx) => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${step.t}</strong> — ${step.s}`;
            list.appendChild(li);
          });
          card.appendChild(list);
          const btnRow = document.createElement('div');
          btnRow.style.textAlign = 'right';
          btnRow.style.marginTop = '12px';
          const copyBtn = document.createElement('button');
          copyBtn.className = 'primary-btn';
          copyBtn.textContent = 'Copy Steps';
          copyBtn.onclick = () => {
            const txt = steps.map((step, i) => `${i+1}. ${step.t} — ${step.s}`).join('\n');
            navigator.clipboard.writeText('Prep Steps:\n' + txt).then(() => {
              alert('Steps copied to clipboard.');
            });
          };
          btnRow.appendChild(copyBtn);
          card.appendChild(btnRow);
          container.appendChild(card);
        },
        // Page 2: How to Build a Case
        function renderM7P2(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>How to Build a Case</h3>
            <p>Sample Resolution:</p>
            <p style="font-style:italic;">The United States federal government should ban single‑use plastics.</p>
            <p>Every strong contention has these key parts:</p>
          `;
          const partsList = document.createElement('ul');
          partsList.style.paddingLeft = '20px';
          const parts = [
            {t:'Claim', s:'Say what you want the judge to believe in one clear sentence.'},
            {t:'Warrant', s:'Explain why the claim is true (the “because”). Keep it short.'},
            {t:'Evidence', s:'Quote or summarize one credible source that supports the warrant.'},
            {t:'Impact', s:'Tell the judge why this result matters for people or policies.'},
            {t:'Weighing', s:'Compare your impact to theirs: bigger, faster, more certain.'}
          ];
          parts.forEach(p => {
            const li = document.createElement('li');
            li.innerHTML = `<strong>${p.t}</strong> — ${p.s}`;
            partsList.appendChild(li);
          });
          card.appendChild(partsList);
          card.innerHTML += `<p>You’re not writing a case here — just learn the pattern.</p>`;
          container.appendChild(card);
        },
        // Page 3: Example Case (Pre‑Highlighted)
        function renderM7P3(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = '<h3>Example Case (Pre‑Highlighted)</h3>';
          const legend = document.createElement('div');
          legend.style.marginBottom = '8px';
          function chip(txt, color) {
            const span = document.createElement('span');
            span.style.background = color;
            span.style.color = '#ffffff';
            span.style.padding = '2px 6px';
            span.style.borderRadius = '4px';
            span.style.marginRight = '6px';
            span.style.fontSize = '12px';
            span.textContent = txt;
            legend.appendChild(span);
          }
          // Use darker backgrounds with white text for legend chips
          chip('Claim','#21365f');
          chip('Warrant','#14532d');
          chip('Evidence','#4c1d95');
          chip('Impact','#854d0e');
          card.appendChild(legend);
          const scroll = document.createElement('div');
          scroll.style.maxHeight = '400px';
          scroll.style.overflowY = 'auto';
          // Dark background so white text remains legible
          scroll.style.background = '#0e2a47';
          scroll.style.color = '#ffffff';
          scroll.style.padding = '12px';
          scroll.style.borderRadius = '4px';
          // Build HTML with semantic spans.  Use data attributes to identify
          // semantic roles; colours are applied dynamically below.
          const text = `
            <p><span data-role="claim">Governments around the world are not doing enough to fight climate change.</span></p>
            <p><span data-role="evidence">Mike 22 says, “Leaders are doing a horrible job at stopping climate change. Pollution keeps going up, and things are getting worse.”</span></p>
            <p><span data-role="warrant">It’s important because many countries follow what the US does.</span></p>
            <p><span data-role="evidence">Smith 21 explains, “When the US withdrew from the Paris Agreement, other countries questioned the reason to continue reducing emissions. However, when the US committed to cutting emissions by 45%, trust was restored, and nations such as Canada, Japan, and China set stronger targets.”</span></p>
            <p><span data-role="evidence">But the US is not doing well with plastic pollution. Williams 21 says, “On a per‑person basis, the US produces more plastic waste than China. The US is behind in regulating plastic pollution.”</span></p>
            <p><span data-role="warrant">This matters because dealing with plastic pollution helps reduce emissions.</span></p>
            <p><span data-role="evidence">Altintepe says, “Over 95% of plastic is produced using fossil fuels,” and Howl 19 shows, “Producing plastic is responsible for roughly 20% of greenhouse gas emissions.”</span></p>
            <p><span data-role="evidence">That’s why Miller 22 says, “Plastic contributes significantly to pollution that drives climate change, making it more difficult to limit global warming to below 1.0 degrees Celsius.”</span></p>
            <p><span data-role="impact">Impact: Lives. Gonzalez 23 reports, “For every 0.1 °C the planet warms, about 100 million lives could be lost.”</span></p>
          `;
          scroll.innerHTML = text;
          // Apply colours and white text to each span based on data-role
          const colourMap = {
            claim: '#21365f',
            warrant: '#14532d',
            evidence: '#4c1d95',
            impact: '#854d0e'
          };
          scroll.querySelectorAll('span').forEach(span => {
            const role = span.getAttribute('data-role');
            if (role && colourMap[role]) {
              span.style.background = colourMap[role];
              span.style.color = '#ffffff';
              span.style.padding = '2px 4px';
              span.style.borderRadius = '4px';
            }
          });
          card.appendChild(scroll);
          container.appendChild(card);
        },
        // Page 4: Removed page
        function renderM7P4(container) {
          // Automatically skip this placeholder page to streamline navigation.
          // Trigger the next button immediately so users don’t see an empty page.
          setTimeout(() => {
            try {
              if (typeof nextBtn !== 'undefined' && nextBtn) nextBtn.click();
            } catch(e) {}
          }, 0);
        },
        // Page 5: Blockfile — What & Why
        function renderM7P5(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Blockfile — What & Why</h3>
            <p>A blockfile is your pre‑written toolkit of responses.</p>
          `;
          const list = document.createElement('ul');
          list.style.paddingLeft = '20px';
          const items = [
            '🧭 Find answers fast during Rebuttal and Crossfire',
            '🧱 Store blocks by opponent’s claim (easy to grab)',
            '🔗 Keep quotes with links for quick evidence calls'
          ];
          items.forEach(it => {
            const li = document.createElement('li');
            li.textContent = it;
            list.appendChild(li);
          });
          card.appendChild(list);
          container.appendChild(card);
        },
        // Page 6: Blockfile — Example Structure
        function renderM7P6(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Blockfile — Example Structure</h3>
            <p>Expand items to see how a blockfile can be organized.</p>
          `;
          const details = document.createElement('details');
          details.open = true;
          const summary = document.createElement('summary');
          summary.textContent = 'PF — Single‑use Plastics';
          details.appendChild(summary);
          const aff = document.createElement('details');
          aff.open = true;
          const affSummary = document.createElement('summary');
          affSummary.textContent = 'AFF Blocks';
          aff.appendChild(affSummary);
          [
            {title:'C1: Marine Harm — alt causes', notes:'Fish death not from bags; study shows runoff bigger driver'},
            {title:'C2: Emissions — marginal effect', notes:'Ban shifts small %; show better policy'}
          ].forEach(item => {
            const d = document.createElement('details');
            const s = document.createElement('summary');
            s.textContent = item.title;
            d.appendChild(s);
            const p = document.createElement('p');
            p.style.marginLeft = '20px';
            p.textContent = item.notes;
            d.appendChild(p);
            aff.appendChild(d);
          });
          details.appendChild(aff);
          const neg = document.createElement('details');
          neg.open = true;
          const negSummary = document.createElement('summary');
          negSummary.textContent = 'NEG Blocks';
          neg.appendChild(negSummary);
          [
            {title:'C1: Jobs — transition', notes:'Evidence: bans raise costs; job loss in packaging sector'},
            {title:'C2: Hygiene — reuse risk', notes:'Meta shows bacteria in reusable bags'}
          ].forEach(item => {
            const d = document.createElement('details');
            const s = document.createElement('summary');
            s.textContent = item.title;
            d.appendChild(s);
            const p = document.createElement('p');
            p.style.marginLeft = '20px';
            p.textContent = item.notes;
            d.appendChild(p);
            neg.appendChild(d);
          });
          details.appendChild(neg);
          card.appendChild(details);
          container.appendChild(card);
        },
        // Page 7: Video + Notes (gated)
        function renderM7P7(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Watch: Blockfile Walkthrough</h3>
            <p>Click to preview an example blockfile. Then jot at least 2 short takeaways.</p>
          `;
          const videoBtn = document.createElement('button');
          videoBtn.className = 'primary-btn';
          videoBtn.textContent = '▶ Open Video';
          videoBtn.onclick = () => {
            window.open('https://drive.google.com/file/d/1gbTIZlWMvNTq9G2A7ZSGJ_kOCQbWNm-u/preview','_blank');
          };
          card.appendChild(videoBtn);
          const notesDiv = document.createElement('div');
          notesDiv.style.marginTop = '12px';
          const notesLabel = document.createElement('p');
          notesLabel.textContent = 'Your notes (at least two short lines):';
          notesLabel.style.fontWeight = 'bold';
          notesDiv.appendChild(notesLabel);
          const textarea = document.createElement('textarea');
          textarea.style.width = '100%';
          textarea.style.minHeight = '100px';
          textarea.placeholder = 'Write your takeaways here...';
          textarea.value = m7State.notes || '';
          textarea.oninput = () => {
            m7State.notes = textarea.value;
          };
          notesDiv.appendChild(textarea);
          card.appendChild(notesDiv);
          const chkDiv = document.createElement('div');
          chkDiv.style.marginTop = '8px';
          const chk = document.createElement('input');
          chk.type = 'checkbox';
          chk.checked = !!m7State.videoWatched;
          chk.onchange = () => { m7State.videoWatched = chk.checked; };
          chkDiv.appendChild(chk);
          const lbl = document.createElement('label');
          lbl.textContent = ' I watched the video';
          lbl.style.marginLeft = '4px';
          chkDiv.appendChild(lbl);
          card.appendChild(chkDiv);
          container.appendChild(card);
        },
        // Page 8: Build a Block (Guided — Optional)
        function renderM7P8(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = '<h3>Build a Block (Guided — Optional)</h3><p>Optional practice. You can skip this page without filling anything out.</p>';
          function makeField(label,key) {
            const wrapper = document.createElement('div');
            wrapper.style.marginBottom = '10px';
            const lab = document.createElement('p');
            lab.textContent = label;
            lab.style.fontWeight = 'bold';
            wrapper.appendChild(lab);
            const txt = document.createElement('textarea');
            txt.style.width = '100%';
            txt.style.minHeight = '60px';
            txt.placeholder = 'Write here...';
            txt.value = m7State[key] || '';
            txt.oninput = () => { m7State[key] = txt.value; updateCounts(); };
            wrapper.appendChild(txt);
            return {wrapper, txt};
          }
          const claim = makeField('Claim (what you argue):','blockClaim');
          const warrant = makeField('Warrant (why it’s true):','blockWarrant');
          const evidence = makeField('Evidence (source or link):','blockEvidence');
          const impact = makeField('Impact (why it matters):','blockImpact');
          card.appendChild(claim.wrapper);
          card.appendChild(warrant.wrapper);
          card.appendChild(evidence.wrapper);
          card.appendChild(impact.wrapper);
          const countRow = document.createElement('p');
          countRow.style.marginTop = '6px';
          function updateCounts() {
            const c = (m7State.blockClaim||'').trim().length;
            const w = (m7State.blockWarrant||'').trim().length;
            const i = (m7State.blockImpact||'').trim().length;
            countRow.innerHTML = `Claim: ${c} chars; Warrant: ${w} chars; Impact: ${i} chars`;
          }
          updateCounts();
          card.appendChild(countRow);
          const copyBtn = document.createElement('button');
          copyBtn.className = 'primary-btn';
          copyBtn.style.marginTop = '8px';
          copyBtn.textContent = 'Copy Full Block';
          copyBtn.onclick = () => {
            const full = `Heading: The United States federal government should ban single-use plastics.\n\n` +
              `Claim:\n${(m7State.blockClaim||'').trim()}\n\n` +
              `Warrant:\n${(m7State.blockWarrant||'').trim()}\n\n` +
              `Evidence:\n${(m7State.blockEvidence||'').trim()}\n\n` +
              `Impact:\n${(m7State.blockImpact||'').trim()}\n`;
            navigator.clipboard.writeText(full).then(() => {
              alert('Copied block to clipboard.');
            });
          };
          card.appendChild(copyBtn);
          container.appendChild(card);
        },
        // Page 9: Block Structure — Example (Concise)
        function renderM7P9(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = '<h3>Block Structure — Example (Clear & Visual)</h3>';
          const section = document.createElement('div');
          function addSection(icon,title,bullets) {
            const blk = document.createElement('div');
            blk.style.marginBottom = '12px';
            const heading = document.createElement('p');
            heading.innerHTML = `<strong>${icon} ${title}</strong>`;
            heading.style.background = '#eef6ff';
            heading.style.border = '1px solid var(--primary-color)';
            heading.style.padding = '6px';
            blk.appendChild(heading);
            const body = document.createElement('ul');
            body.style.paddingLeft = '20px';
            bullets.forEach(b => {
              const li = document.createElement('li');
              li.textContent = b;
              body.appendChild(li);
            });
            blk.appendChild(body);
            section.appendChild(blk);
          }
          addSection('🧱','What is a Block?',[
            'A short, pre‑written response to a specific claim you expect.',
            'Kept in a “blockfile” so you can grab it fast during Rebuttal/Crossfire.',
            'Each block has the same shape: Claim → Warrant → Evidence → Impact (→ Weigh if needed).'
          ]);
          const skel = document.createElement('pre');
          skel.textContent = 'Block skeleton:\n[Claim]\n[Warrant]\n[Evidence]\n[Impact]';
          skel.style.background = '#f9fafb';
          skel.style.padding = '8px';
          skel.style.border = '1px solid rgba(0,0,0,0.1)';
          section.appendChild(skel);
          card.appendChild(section);
          container.appendChild(card);
        },
        // Page 10: Completion
        function renderM7P10(container) {
          container.innerHTML = '';
          const card = document.createElement('div');
          card.className = 'card';
          card.innerHTML = `
            <h3>Module Complete!</h3>
            <p>Great job completing the Prep for a Debate Round module!</p>
            <p>You've earned ${modules.find(m=>m.id==='m7').reward} gems!</p>
            <div style="font-size:48px;">💎</div>
          `;
          container.appendChild(card);
        }
      ],
      state: {}
    }
  ];

  // runtime state per module (m1 and m3) defined above
  const m1State = modules.find(m=>m.id==='m1').state;
  const m3State = modules.find(m=>m.id==='m3').state;
  // additional states for newly expanded modules
  const m4State = modules.find(m=>m.id==='m4').state;
  const m5State = modules.find(m=>m.id==='m5').state;
  const m6State = modules.find(m=>m.id==='m6').state;
  const m7State = modules.find(m=>m.id==='m7').state;

  // Variables to track current module and page index
  let currentModule = null;
  let pageIndex = 0;

  // Reference to DOM elements
  const moduleListEl = document.getElementById('module-list');
  const moduleTitleEl = document.getElementById('module-title');
  const pageContainerEl = document.getElementById('page-container');
  const backBtn = document.getElementById('back-btn');
  const nextBtn = document.getElementById('next-btn');
  const progressBarEl = document.getElementById('progress-bar');

  // Populate sidebar with modules
  function buildModuleList() {
    moduleListEl.innerHTML = '';
    modules.forEach((mod, idx) => {
      const li = document.createElement('li');
      li.className = 'module-item';
      // Create a button rather than an anchor to better control states
      const btn = document.createElement('button');
      btn.className = 'module-button';
      // Preserve the active state for the current module
      if (currentModule && currentModule.id === mod.id) btn.classList.add('active');
      // Determine if this module has been completed
      const isComplete = AppState.isModuleComplete(mod.id);
      // Determine if this module should be unlocked. It is unlocked if it is the first
      // module or the previous module has been completed, or if the module itself is already complete.
      const isFirst = idx === 0;
      const prevComplete = isFirst ? true : AppState.isModuleComplete(modules[idx - 1].id);
      const unlocked = isFirst || prevComplete || isComplete;
      // Apply the appropriate state classes
      if (isComplete) {
        btn.classList.add('completed');
      } else if (!unlocked) {
        btn.classList.add('locked');
      }
      // Insert the module title
      const titleSpan = document.createElement('span');
      titleSpan.className = 'title';
      titleSpan.textContent = mod.title;
      btn.appendChild(titleSpan);
      // Attach click handler only if the module is unlocked
      if (unlocked) {
        btn.onclick = () => loadModule(mod);
        btn.disabled = false;
      } else {
        // Disable interaction for locked modules
        btn.disabled = true;
      }
      li.appendChild(btn);
      moduleListEl.appendChild(li);
    });
  }

  // Load a module and show its first page
  function loadModule(mod) {
    currentModule = mod;
    pageIndex = 0;
    updateNavButtons();
    renderPage();
    buildModuleList();
  }

  // Render the current page of the active module
  function renderPage() {
    if (!currentModule) return;
    moduleTitleEl.textContent = currentModule.title;
    // Call page renderer
    const renderer = currentModule.pages[pageIndex];
    renderer(pageContainerEl);
    updateNavButtons();
    updateProgressBar();
  }

  // Update progress bar width and nav button states
  function updateProgressBar() {
    if (!currentModule) {
      progressBarEl.style.width = '0%';
      return;
    }
    const total = currentModule.pages.length;
    const perc = ((pageIndex + 1) / total) * 100;
    progressBarEl.style.width = perc + '%';
  }

  function updateNavButtons() {
    if (!currentModule) {
      backBtn.disabled = true;
      nextBtn.disabled = true;
      return;
    }
    backBtn.disabled = pageIndex === 0;
    nextBtn.disabled = false;
    // Last page – label may change to Finish
    nextBtn.textContent = pageIndex === currentModule.pages.length - 1 ? 'Finish' : 'Next';
  }

  // Move to the next page or finish a module
  nextBtn.addEventListener('click', () => {
    if (!currentModule) return;
    // Validate if necessary
    if (!validateCurrentPage()) return;
    if (pageIndex < currentModule.pages.length - 1) {
      pageIndex++;
      renderPage();
    } else {
      // Completed module
      // Award gems only if not already completed
      if (!AppState.isModuleComplete(currentModule.id)) {
        AppState.addGems(currentModule.reward);
        AppState.markModuleComplete(currentModule.id);
      }
      // Return to module list view
      pageContainerEl.innerHTML = '';
      moduleTitleEl.textContent = 'Select a module';
      currentModule = null;
      buildModuleList();
      updateNavButtons();
      updateProgressBar();
    }
  });

  // Move to the previous page
  backBtn.addEventListener('click', () => {
    if (!currentModule) return;
    if (pageIndex > 0) {
      pageIndex--;
      renderPage();
    }
  });

  // Validate user input before advancing pages
  function validateCurrentPage() {
    if (!currentModule) return true;
    // Module 1 validation
    if (currentModule.id === 'm1') {
      if (pageIndex === 1) {
        if (!m1State.experience) {
          alert('Please select your experience level to continue.');
          return false;
        }
      } else if (pageIndex === 2) {
        if (!m1State.school) {
          alert('Please select if you debate through school.');
          return false;
        }
        if (m1State.school === 'Yes') {
          const nameInput = document.getElementById('m1_school_name');
          const val = nameInput ? nameInput.value.trim() : '';
          if (!val) {
            alert('Please enter your school name.');
            return false;
          }
          m1State.school_name = val;
        }
      } else if (pageIndex === 3) {
        if (!m1State.goal) {
          alert('Please select a goal to continue.');
          return false;
        }
      } else if (pageIndex === 4) {
        if (!m1State.discovery) {
          alert('Please select how you found us.');
          return false;
        }
        // Save responses at page4 (0‑based index 4 is the discovery page before thank you)
        // We store responses to the module data in localStorage
        const state = AppState.get();
        state.modules['m1'] = state.modules['m1'] || {};
        state.modules['m1'].responses = {
          experience: m1State.experience,
          school: m1State.school,
          school_name: m1State.school_name,
          goal: m1State.goal,
          discovery: m1State.discovery
        };
        AppState.save(state);
      }
    }
    // Module 3 validation
    if (currentModule.id === 'm3') {
      if (pageIndex === 1) { // choose topic
        if (!m3State.topic) {
          alert('Please select a topic to continue.');
          return false;
        }
      } else if (pageIndex === 2) { // choose side
        if (!m3State.side) {
          alert('Please select whether you agree or disagree.');
          return false;
        }
      } else if (pageIndex === 3) { // argument text
        if (!m3State.reason || m3State.reason.length < 25) {
          alert('Please write at least 25 characters.');
          return false;
        }
      }
      // Save responses when leaving last input page
      if (pageIndex === 3) {
        const state = AppState.get();
        state.modules['m3'] = state.modules['m3'] || {};
        state.modules['m3'].responses = {
          topic: m3State.topic,
          side: m3State.side,
          reason: m3State.reason
        };
        AppState.save(state);
      }
    }
    // Module 4 validation
    if (currentModule.id === 'm4') {
      // page order corresponds to pages array: index0..13
      // P1 quick check
      if (pageIndex === 0) {
        if (m4State.page1 !== 'Cases are written in advance') {
          alert("Choose the correct answer to continue.");
          return false;
        }
      } else if (pageIndex === 2) {
        if (m4State.page3 !== 'It presents a specific contention with a claim') {
          alert('Choose the correct answer to continue.');
          return false;
        }
      } else if (pageIndex === 3) {
        if (!m4State.rebuttal || m4State.rebuttal.length === 0) {
          alert('Write a brief rebuttal before continuing.');
          return false;
        }
      } else if (pageIndex === 4) {
        if (!m4State.summary || m4State.summary.length === 0) {
          alert('Write a brief summary before continuing.');
          return false;
        }
      } else if (pageIndex === 5) {
        if (m4State.page6 !== "Challenge the study's relevance due to its age") {
          alert('Choose the correct answer to continue.');
          return false;
        }
      } else if (pageIndex === 6) {
        if (m4State.page7 !== 'Select the most important voting issues and weigh clearly') {
          alert('Choose the correct answer to continue.');
          return false;
        }
      } else if (pageIndex === 7) {
        if (!m4State.speechOrderCorrect) {
          alert('Arrange the speeches in the correct order to continue.');
          return false;
        }
      } else if (pageIndex === 8) {
        if (m4State.page9 !== 'Plan responses to their rebuttal arguments') {
          alert('Choose the correct answer to continue.');
          return false;
        }
      } else if (pageIndex === 10) {
        if (m4State.page11 !== 'Focus on clear, real‑world examples') {
          alert('Choose the correct answer to continue.');
          return false;
        }
      } else if (pageIndex === 11) {
        if (m4State.page12 !== 'Going for trivial points instead of winning issues') {
          alert('Choose the correct answer to continue.');
          return false;
        }
      } else if (pageIndex === 12) {
        // final review quiz must all be correct
        const answers = m4State.finalAnswers || {};
        const ok = answers.q1 === '3 minutes' && answers.q2 === 'A single debater doing both speeches' && answers.q3 === '3 minutes';
        if (!ok) {
          alert('Answer all review questions correctly to continue.');
          return false;
        }
      }
      return true;
    }
    // Module 2 validation (Debate Etiquette & Professional Conduct)
    // The original build let learners click through the scenario pages without making a choice.
    // To reinforce active engagement, require a response on each scenario page.
    if (currentModule.id === 'm2') {
      // Page order: 0 = guidelines, 1 = crossfire guidelines, 2 = attire scenario,
      // 3 = crossfire conduct scenario, 4 = judge interaction scenario, 5 = final review.
      if (pageIndex === 2) {
        // Attire scenario – ensure the learner picks an outfit option
        const checked = document.querySelector('input[name="m2_attire"]:checked');
        if (!checked) {
          alert('Please select an attire option before continuing.');
          return false;
        }
      } else if (pageIndex === 3) {
        // Crossfire conduct scenario – ensure the learner chooses a response
        const checked = document.querySelector('input[name="m2_crossfire"]:checked');
        if (!checked) {
          alert('Please select how you would respond in crossfire before continuing.');
          return false;
        }
      } else if (pageIndex === 4) {
        // Judge interaction scenario – ensure the learner chooses a professional response
        const checked = document.querySelector('input[name="m2_judge"]:checked');
        if (!checked) {
          alert('Please select what you would do after the judge votes against you before continuing.');
          return false;
        }
      }
    }
    // Module 5 validation
    if (currentModule.id === 'm5') {
      // page indices: 0..6
      if (pageIndex === 0) {
        if (m5State.page1 !== 0) {
          alert('Select the correct team for the first question.');
          return false;
        }
      } else if (pageIndex === 1) {
        if (m5State.introCorrect !== 3) {
          alert('Mark all introductory questions correctly to continue.');
          return false;
        }
      } else if (pageIndex === 2) {
        if (m5State.classifyCorrect !== 6) {
          alert('Classify all questions correctly to continue.');
          return false;
        }
      } else if (pageIndex === 3) {
        if (m5State.quizScore !== 3) {
          alert('Answer all listening questions correctly to continue.');
          return false;
        }
      } else if (pageIndex === 4) {
        if (m5State.goodBadScore !== 6) {
          alert('Mark all tactics as Good or Bad correctly to continue.');
          return false;
        }
      }
      return true;
    }
    // Module 6 validation
    if (currentModule.id === 'm6') {
      // page indices: 0..5
      if (pageIndex === 1) {
        // require at least four notes
        const rows = m6State.practiceRows || [];
        let count = 0;
        rows.forEach(r => {
          if (r && r.trim().length > 0 && r.trim().toLowerCase() !== 'write here') count++;
        });
        if (count < 4) {
          alert('Please fill at least four rows of notes before continuing.');
          return false;
        }
      } else if (pageIndex === 4) {
        if (m6State.quizCorrect !== 6) {
          alert('Answer all flow questions correctly to continue.');
          return false;
        }
      }
      return true;
    }
    // Module 7 validation
    if (currentModule.id === 'm7') {
      // page indices: 0..9
      if (pageIndex === 6) {
        const notes = m7State.notes || '';
        const lines = notes.split('\n').filter(l => l.trim().length > 0);
        if (!m7State.videoWatched || lines.length < 2) {
          alert('Please watch the video and write at least two lines of notes.');
          return false;
        }
      }
      return true;
    }
    return true;
  }

  // Initialise gem bar and module list
  updateGemBar();
  buildModuleList();
  // Initially no module selected – disable nav controls
  updateNavButtons();
  updateProgressBar();
  </script>

<style>
/* Updated interactive styles for high contrast and white text.  The earlier
   light pastels made white text illegible; these colours are darker and
   pair with white text. */
.choice {
  display:inline-block;
  padding:6px 10px;
  border-radius:8px;
  border:1px solid rgba(255,255,255,0.3);
  margin:4px 6px;
  cursor:pointer;
  transition:background .15s, border-color .15s;
  color:#ffffff;
  background:rgba(255,255,255,0.05);
}
.choice input { margin-right:6px; }
.choice.correct {
  /* Do not fill the entire chip when correct; instead use a coloured left border */
  background: rgba(255,255,255,0.05);
  border-left: 6px solid #16a34a;
  border-color: #16a34a;
}
.choice.incorrect {
  /* Indicate incorrect choice with a red border but keep the dark background */
  background: rgba(255,255,255,0.05);
  border-left: 6px solid #dc2626;
  border-color: #dc2626;
}
.choice.neutral {
  background: rgba(255,255,255,0.05);
  border-color: rgba(255,255,255,0.3);
}

.signpost-row {
  display:flex;
  align-items:center;
  gap:12px;
  padding:8px 10px;
  margin:6px 12px;
  border-radius:10px;
  background:rgba(255,255,255,0.05);
  color:#ffffff;
  border:1px solid rgba(255,255,255,0.15);
}
.signpost-row.correct {
  /* Use a coloured border rather than filling the row so text remains legible */
  background: rgba(255,255,255,0.05);
  border-left: 6px solid #16a34a;
  border-color: #16a34a;
}
.signpost-row.incorrect {
  background: rgba(255,255,255,0.05);
  border-left: 6px solid #dc2626;
  border-color: #dc2626;
}

.signpost-badge {
  font-size:12px;
  font-weight:700;
  padding:2px 8px;
  border-radius:999px;
}
.signpost-badge.ok { background:#14532d; color:#d1fae5; }
.signpost-badge.no { background:#7f1d1d; color:#fee2e2; }

mark.claim { background:#21365f; color:#ffffff; }
mark.warrant { background:#14532d; color:#ffffff; }
mark.evidence { background:#4c1d95; color:#ffffff; }
mark.impact { background:#854d0e; color:#ffffff; }

.pill {
  display:inline-block;
  padding:2px 8px;
  border-radius:999px;
  font-weight:700;
  margin-right:8px;
  border:1px solid rgba(255,255,255,0.3);
  color:#ffffff;
}
.pill.claim { background:#21365f; }
.pill.warrant { background:#14532d; }
.pill.evidence { background:#4c1d95; }
.pill.impact { background:#854d0e; }

  /* -------------------------------------------------------------------------
     Additional button and row styling (added in response to feedback)
     The following rules improve contrast for the small buttons used in module
     8 and 9 (Good/Bad selections, copy buttons, etc.) and ensure all text in
     signpost rows remains white. Without these rules the default browser
     buttons showed dark text on light backgrounds, which blended into the dark
     theme, and some nested elements in the signpost rows inherited dark
     colours.  These declarations override that behaviour with a dark
     translucent background and white text.
  */
  button.button {
    background: rgba(255,255,255,0.07);
    color: #ffffff;
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 6px;
    padding: 4px 10px;
    margin-left: 4px;
    cursor: pointer;
    transition: background .15s;
  }
  button.button:hover {
    background: rgba(255,255,255,0.15);
  }
  .signpost-row, .signpost-row * {
    color: #ffffff !important;
  }
</style>

<script>
if (!window.__M8_M9_INSERTED__) (function(){ window.__M8_M9_INSERTED__ = true;
function makeCard(){ const d=document.createElement('div'); d.className='card'; return d; }
function labelChoice(txt,name,val,selected,onpick){ 
  const lab=document.createElement('label'); lab.className='choice '+(selected?'neutral':'');
  const inp=document.createElement('input'); inp.type='radio'; inp.name=name; inp.value=val;
  if (selected) inp.checked = (selected===val);
  lab.appendChild(inp); lab.insertAdjacentText('beforeend',' '+txt);
  lab.onclick=(e)=>{ if (typeof onpick==='function') onpick(val,lab); };
  return lab;
}
const m8Module={ id:'m8', title:'Case Writing', reward:25, state:{ q1:null, q2:null }, pages:[
  function(container){ const st=m8Module.state; container.innerHTML=''; const card=makeCard(); card.innerHTML=`
    <h3>Introduction to Case Writing</h3>
    <div class="section">
      <h4>Case/Constructive (4 minutes):</h4>
      <ul>
        <li>Introduces arguments for the round</li>
        <li>Generally 2–3 contentions/arguments</li>
        <li>Usually a ~650–775 word speech</li>
        <li>Pre-flow your case before the round (have a flow of your case ready)</li>
      </ul>
    </div>
    <div class="section">
      <h4>Key Tips:</h4>
      <ul>
        <li>Structure your case with clear contentions.</li>
        <li>Clearly signpost contentions (“My first/second/third contention is…”).</li>
        <li>Speak clearly so the judge can hear and understand you.</li>
        <li>Make eye contact with the judge.</li>
      </ul>
    </div>`;
    const q1=document.createElement('div'); q1.className='section'; q1.innerHTML='<strong>Quick Check:</strong> How many contentions are <em>typical</em>?';
    const g1=document.createElement('div'); const choices1=['1','2–3','6–8']; const correct1='2–3';
    choices1.forEach((o)=>{ const lab=labelChoice(o,'m8_q1',o,st.q1,(val,el)=>{ st.q1=val; [...g1.children].forEach(ch=>ch.classList.remove('correct','incorrect')); el.classList.add(val===correct1?'correct':'incorrect'); }); g1.appendChild(lab); });
    q1.appendChild(g1); card.appendChild(q1);
    const q2=document.createElement('div'); q2.className='section'; q2.innerHTML="<strong>Quick Check:</strong> What’s the best way to begin your case?";
    const g2=document.createElement('div'); const choices2=['Read very fast to save time','Clearly and confidently read your case','Start with a joke']; const correct2='Clearly and confidently read your case';
    choices2.forEach((o)=>{ const lab=labelChoice(o,'m8_q2',o,st.q2,(val,el)=>{ st.q2=val; [...g2.children].forEach(ch=>ch.classList.remove('correct','incorrect')); el.classList.add(val===correct2?'correct':'incorrect'); }); g2.appendChild(lab); });
    q2.appendChild(g2); card.appendChild(q2); container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML=`
    <h3>Parts of a Contention</h3>
    <p><strong>Every strong contention has these key parts:</strong></p>
    <ul><li>1. Uniqueness</li><li>2. Claim</li><li>3. Warrant + Evidence</li><li>4. Impact</li></ul>
    <div class="section"><h4>Example Skeleton:</h4><pre>[Uniqueness]\n[Claim]\n[Warrant]\n[Evidence]\n[Impact]</pre></div>`; container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); const img=document.createElement('img'); img.src='images/CaseWriting.png'; img.alt='Example Case Structure'; img.style.maxWidth='100%'; img.style.border='1px solid rgba(0,0,0,0.08)'; img.style.borderRadius='10px'; img.onerror=function(){ card.innerHTML=`
      <h3>Case Example & How it’s Formatted</h3>
      <p style="color:#b91c1c;font-weight:700;">Could not load images/CaseWriting.png</p>
      <p>Make sure the file exists at:<br><code>images/CaseWriting.png</code></p>`; };
    const h=document.createElement('h3'); h.textContent='Case Example & How it’s Formatted'; const cap=document.createElement('div'); cap.textContent='Figure: Example Case Structure'; cap.style.color='#6b7280'; cap.style.fontStyle='italic'; cap.style.marginTop='6px';
    card.appendChild(h); card.appendChild(img); card.appendChild(cap); container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML=`
    <h3>Example Contention</h3>
    <p><em>A case contains contentions (arguments), usually 2–3. Below is an example of one contention with made‑up evidence — not for real use.</em></p>
    <textarea class="form-input" style="min-height:320px;">Contention 1: Climate Change\n\nGovernments around the world are not doing enough to fight climate change.\n\nMike 22 says, “Leaders are doing a horrible job at stopping climate change. Pollution keeps going up, and things are getting worse.”\n\nIt’s important because many countries follow what the US does.\n\nSmith 21 explains, “When the US withdrew from the Paris Agreement, other countries questioned the reason to continue reducing emissions. However, when the US committed to cutting emissions by 45%, trust was restored, and nations such as Canada, Japan, and China set stronger targets.”\n\nBut the US is not doing well with plastic pollution. Williams 21 says, “On a per-person basis, the US produces more plastic waste than China. The US is behind in regulating plastic pollution.”\n\nThis matters because dealing with plastic pollution helps reduce emissions.\n\nAltintepe says, “Over 95% of plastic is produced using fossil fuels,” and Howl 19 shows, “Producing plastic is responsible for roughly 20% of greenhouse gas emissions.”\n\nThat’s why Miller 22 says, “Plastic contributes significantly to pollution that drives climate change, making it more difficult to limit global warming to below 1.0 degrees Celsius.”\n\nImpact: Lives. Gonzalez 23 reports, “For every 0.1 °C the planet warms, about 100 million lives could be lost.”</textarea>`; container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML=`
    <h3>Explaining the Parts</h3>
    <div class="section">
      <p><strong>1. Uniqueness – What's true right now.</strong><br/>Explains the current situation before the plan/action. Shows why your argument matters now.</p>
      <p><strong>2. Claim – Your main point.</strong><br/>The assertion you're proving (one sentence).</p>
      <p><strong>3. Warrant – Why the claim is true.</strong><br/>Explains the 'because' behind your claim (the logic).</p>
      <p><strong>4. Evidence – Proof from a credible source.</strong><br/>Facts, studies, experts, statistics that support the warrant.</p>
      <p><strong>5. Impact – Why it matters.</strong><br/>Real-world consequence; what changes for people or policy.</p>
    </div>`; container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); const raw=`Contention 1: Climate Change\n\nGovernments around the world are not doing enough to fight climate change.\n\nMike 22 says, “Leaders are doing a horrible job at stopping climate change. Pollution keeps going up, and things are getting worse.”\n\nIt’s important because many countries follow what the US does.\n\nSmith 21 explains, “When the US withdrew from the Paris Agreement, other countries questioned the reason to continue reducing emissions. However, when the US committed to cutting emissions by 45%, trust was restored, and nations such as Canada, Japan, and China set stronger targets.”\n\nBut the US is not doing well with plastic pollution. Williams 21 says, “On a per-person basis, the US produces more plastic waste than China. The US is behind in regulating plastic pollution.”\n\nThis matters because dealing with plastic pollution helps reduce emissions.\n\nAltintepe says, “Over 95% of plastic is produced using fossil fuels,” and Howl 19 shows, “Producing plastic is responsible for roughly 20% of greenhouse gas emissions.”\n\nThat’s why Miller 22 says, “Plastic contributes significantly to pollution that drives climate change, making it more difficult to limit global warming to below 1.0 degrees Celsius.”\n\nImpact: Lives. Gonzalez 23 reports, “For every 0.1 °C the planet warms, about 100 million lives could be lost.”`;
    let html=raw
      .replace(/Governments around the world are not doing enough to fight climate change\./g,'<mark class="claim">Governments around the world are not doing enough to fight climate change.</mark>')
      .replace(/It’s important because many countries follow what the US does\./g,'<mark class="warrant">It’s important because many countries follow what the US does.</mark>')
      .replace(/This matters because dealing with plastic pollution helps reduce emissions\./g,'<mark class="warrant">This matters because dealing with plastic pollution helps reduce emissions.</mark>')
      .replace(/Mike 22 says.*?\n/g,'<mark class="evidence">$&</mark>')
      .replace(/Smith 21 explains.*?\n/g,'<mark class="evidence">$&</mark>')
      .replace(/Gonzalez 23 reports.*?$/gm,'<mark class="impact">$&</mark>');
    const legend=document.createElement('div'); legend.className='section'; legend.innerHTML='<strong>Legend:</strong> <span class="pill claim">Claim</span> <span class="pill warrant">Warrant</span> <span class="pill evidence">Evidence</span> <span class="pill impact">Impact</span>';
    const pre=document.createElement('pre'); pre.innerHTML=html; pre.style.whiteSpace='pre-wrap'; pre.style.lineHeight='1.55';
    const h=document.createElement('h3'); h.textContent='Example Contention — Highlighted';
    card.appendChild(h); card.appendChild(legend); card.appendChild(pre); container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML=`
    <h3>AI Casewriter</h3>
    <p><strong>PUBLICFORUMAI HELPS!</strong></p>
    <ul><li>Improve your case writing</li><li>Use PFAI’s AI Casewriter to draft and refine contentions</li><li>Explore potential contentions with auto-generated evidence</li><li>Practice & improve with guided suggestions</li></ul>
    <p><a href="https://publicforumai.com/casewriter.html" target="_blank">Try it now at PublicForumAI.com</a></p>`; container.appendChild(card); },
  function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML=`
    <h3>Recap</h3>
    <ul><li>Case = 2–3 contentions with clear structure</li><li>Signpost contentions clearly</li><li>Claim → Warrant → Evidence → Impact</li></ul>`; container.appendChild(card); },
  function(container){
    container.innerHTML='';
    const card=makeCard();
    // Show reward amount so learners know how many gems they earned.
    const reward = (typeof m8Module !== 'undefined' && m8Module.reward) ? m8Module.reward : 25;
    card.innerHTML=`<h3>Module Complete!</h3><p>Congratulations! You\'ve learned how to write effective debate cases.</p><p>You\'ve earned ${reward} gems!</p>`;
    const gemIcon=document.createElement('div');
    gemIcon.textContent='💎';
    gemIcon.style.fontSize='48px';
    gemIcon.style.textAlign='center';
    card.appendChild(gemIcon);
    container.appendChild(card);
  }
]}

const m9Module={ id:'m9', title:'Rebuttal', reward:25,
  state:{ p1:null, signpostSelections:[null,null,null,null], p3:null, toolkitAnswers:[], weighChecks:[0,0,0,0,0] },
  pages:[
    function(container){ const st=m9Module.state; container.innerHTML=''; const card=makeCard(); card.innerHTML=`
      <h3>Rebuttals — What & When</h3>
      <p>Rebuttals are where you respond to your opponent’s arguments.</p>
      <div class="section"><h4>Timing</h4>
        <ul>
          <li>1st Rebuttal — 4:00 (first speaker responds to their case)</li>
          <li>2nd Rebuttal — 4:00 (second speaker frontlines + rebuts)</li>
        </ul>
      </div>
      <div class="section"><strong>Quick Check (must be correct to continue):</strong><br/>How long is 2nd Rebuttal?</div>`;
      const group=document.createElement('div');
      ['3:00','4:00','5:00'].forEach((o)=>{ const lab=labelChoice(o,'m9_p1',o,st.p1,(val,el)=>{ st.p1=val; [...group.children].forEach(ch=>ch.classList.remove('correct','incorrect')); el.classList.add(val==='4:00'?'correct':'incorrect'); }); group.appendChild(lab); });
      card.appendChild(group); container.appendChild(card); },
    function(container){ const st=m9Module.state; container.innerHTML=''; const card=makeCard();
      const head=document.createElement('div'); head.innerHTML=`
        <h3>How to Give Rebuttals</h3>
        <div class="section"><strong>Keys:</strong>
          <ul>
            <li>Frontline your own case before addressing theirs (in 2nd Rebuttal).</li>
            <li>Use clear roadmaps and signposting so judges can follow.</li>
            <li>Warrant your responses and prefer evidence over assertions.</li>
            <li>Set up weighing to explain why your impacts matter more.</li>
          </ul>
        </div>
        <div class="section"><strong>Classifier: Is this good signposting? (must be all correct)</strong></div>`; card.appendChild(head);
      const items=[["On their Contention 2 about emissions\u2026", 1], ["Also, they said some stuff about the environment\u2026", 0], ["Next, on their third point about costs\u2026", 1], ["They\u2019re wrong, here\u2019s why\u2026", 0]]; st.signpostSelections=st.signpostSelections.map(v=>(typeof v==='number'?v:-1));
      const status=document.createElement('div'); status.style.fontWeight='700'; status.style.margin='6px 0 8px 16px'; status.textContent='0/'+items.length+' correct'; card.appendChild(status);
      items.forEach((it,idx)=>{ const row=document.createElement('div'); row.className='signpost-row';
        const txt=document.createElement('div'); txt.textContent=it[0]; row.appendChild(txt);
        const badge=document.createElement('span'); badge.className='signpost-badge'; row.appendChild(badge);
        const good=document.createElement('button'); good.className='button'; good.textContent='Good';
        const bad=document.createElement('button'); bad.className='button'; bad.textContent='Bad';
        function updateRow(sel){ if(sel===it[1]){ row.classList.add('correct'); row.classList.remove('incorrect'); badge.textContent='Correct'; badge.className='signpost-badge ok'; }
          else if(sel===0 || sel===1){ row.classList.add('incorrect'); row.classList.remove('correct'); badge.textContent='Try again'; badge.className='signpost-badge no'; }
          else { row.classList.remove('correct','incorrect'); badge.textContent=''; badge.className='signpost-badge'; } }
        [good,bad].forEach((btn,bi)=>{ btn.onclick=()=>{ st.signpostSelections[idx]=(bi===0?1:0); recompute(); updateRow(st.signpostSelections[idx]); }; });
        row.appendChild(good); row.appendChild(bad); card.appendChild(row); updateRow(st.signpostSelections[idx]); });
      function recompute(){ let ok=0; items.forEach((it,i)=>{ if(st.signpostSelections[i]===it[1]) ok++; }); status.textContent= ok + '/'+items.length+' correct'; }
      recompute(); container.appendChild(card); },
    function(container){ const st=m9Module.state; container.innerHTML=''; const card=makeCard(); card.innerHTML=`
      <h3>Frontlining</h3>
      <p>Frontlining means defending your case against their attacks <em>before</em> you go to rebut their case (in 2nd Rebuttal).</p>
      <div class="section"><strong>Quick Check (must be correct):</strong> What is frontlining?</div>`;
      const group=document.createElement('div'); const opts=[
        'Defending your case against their attacks before rebutting theirs','Reviewing your partner’s speech after the round','Reading new evidence in crossfire'];
      const correct=opts[0];
      opts.forEach((o)=>{ const lab=labelChoice(o,'m9_p3',o,st.p3,(val,el)=>{ st.p3=val; [...group.children].forEach(ch=>ch.classList.remove('correct','incorrect')); el.classList.add(val===correct?'correct':'incorrect'); }); group.appendChild(lab); });
      card.appendChild(group); container.appendChild(card); },
    function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML=`
      <h3>Roadmaps & Signposting</h3>
      <div class="section">
        <h4>What’s a Roadmap?</h4>
        <p>A brief off-time preview of your speech order so the judge can follow.<br/>Say it BEFORE you start time.</p>
        <p><em>“For my off-time roadmap, I will: 1) Frontline our case, 2) Rebut their case, 3) Weigh if time allows.”</em></p>
        <button class="button" id="copyRoadmap">Copy roadmap line</button>
      </div>
      <div class="section">
        <h4>What’s Signposting?</h4>
        <p>Short labels that point to EXACTLY which argument you’re answering, in their order. Keeps judge and opponents on your flow.</p>
        <div><strong>Good Signposting Examples:</strong>
          <ul><li>“On their Contention 1 about emissions…”</li><li>“Next, on their second point about costs…”</li><li>“Finally, on their third claim regarding hygiene…”</li></ul>
        </div>
      </div>`; container.appendChild(card);
      const btn=document.getElementById('copyRoadmap'); if(btn) btn.onclick=()=>navigator.clipboard.writeText('For my off-time roadmap, I will: 1) Frontline our case, 2) Rebut their case, 3) Weigh if time allows.'); },
    function(container){ const st=m9Module.state; container.innerHTML=''; const card=makeCard(); card.innerHTML='<h3>Rebuttal Toolkit — Pick the Best Response</h3><p>For each opponent claim, choose the strongest reply type.</p>';
      const status=document.createElement('div'); status.style.fontWeight='700'; status.style.margin='6px 0 8px 12px'; card.appendChild(status);
      const data=[["Opponent: \u201cBanning plastics kills jobs immediately.\u201d", ["Evidence: \u2018Study shows net job growth in alternatives within 6 months.\u2019", "Logic: \u2018Jobs don\u2019t matter.\u2019", "Evidence: \u2018My friend lost a job once.\u2019"], 0], ["Opponent: \u201cEmissions barely change.\u201d", ["Logic: \u2018Your mechanism misses upstream production.\u2019", "Evidence: \u2018Meta-analysis finds 10\u201320% reductions where bans passed.\u2019", "Logic: \u2018We disagree.\u2019"], 1], ["Opponent: \u201cHygiene collapses without plastic.\u201d", ["Evidence: \u2018CDC notes reusables safe with washing; outbreaks not linked to bans.\u2019", "Logic: \u2018That\u2019s silly.\u2019", "Evidence: \u2018Some blogs say bags are dirty.\u2019"], 0]]; if(!st.toolkitAnswers.length) st.toolkitAnswers=Array(data.length).fill(-1);
      function recompute(){ let ok=0; data.forEach((d,i)=>{ if(st.toolkitAnswers[i]===d[2]) ok++; }); status.textContent= ok + '/' + data.length + ' correct'; }
      data.forEach((d,i)=>{ const box=document.createElement('div'); box.style.margin='8px 12px'; box.style.padding='8px'; box.style.border='1px solid rgba(0,0,0,0.1)'; box.style.borderRadius='10px';
        const prompt=document.createElement('div'); prompt.style.fontWeight='700'; prompt.textContent=(i+1)+'. '+d[0]; box.appendChild(prompt);
        const grp=document.createElement('div');
        d[1].forEach((choice,j)=>{ const lab=labelChoice(choice,'m9_mcq_'+i,j, (st.toolkitAnswers[i]===j? j : null), (val,el)=>{ st.toolkitAnswers[i]=j; [...grp.children].forEach(ch=>ch.classList.remove('correct','incorrect')); el.classList.add(j===d[2]?'correct':'incorrect'); recompute(); }); grp.appendChild(lab); });
        box.appendChild(grp); card.appendChild(box); });
      recompute(); container.appendChild(card); },
    function(container){ const st=m9Module.state; container.innerHTML=''; const card=makeCard(); card.innerHTML=`
      <h3>Weighing — Make the Judge Care</h3>
      <p>Use weighing to tell the judge why your impacts matter more.</p>
      <div class="section"><div class="pill">Magnitude (how big)</div><div class="pill">Timeframe (how soon)</div><div class="pill">Probability (how likely)</div><div class="pill">Reversibility (can they fix it?)</div></div>
      <div class="section"><strong>Select all lines that are valid weighing:</strong></div>`;
      if(!st.weighChecks.length) st.weighChecks=Array(5).fill(0);
      const lines=[["Our impact is larger in magnitude and happens sooner than theirs.", 1], ["Their argument is dumb.", 0], ["Ours is more probable and less reversible.", 1], ["We disagree; move on.", 0], ["Even if they\u2019re right, our harm outweighs on lives saved.", 1]]; const status=document.createElement('div'); status.style.fontWeight='700'; status.style.margin='6px 0 8px 16px'; card.appendChild(status);
      function recompute(){ let ok=0,total=0; lines.forEach((ln,i)=>{ if(ln[1]===1){ total++; if(st.weighChecks[i]===1) ok++; } }); status.textContent= ok + '/' + total + ' selected'; }
      lines.forEach((ln,i)=>{ const row=document.createElement('div'); row.style.margin='4px 16px'; const lab=document.createElement('label'); const cb=document.createElement('input'); cb.type='checkbox'; cb.checked=!!st.weighChecks[i];
        cb.onchange=()=>{ st.weighChecks[i]=cb.checked?1:0; recompute(); }; lab.appendChild(cb); lab.insertAdjacentText('beforeend',' '+ln[0]); row.appendChild(lab); card.appendChild(row); });
      recompute(); container.appendChild(card); },
    function(container){ container.innerHTML=''; const card=makeCard(); const h=document.createElement('h3'); h.textContent='Frontline Mini-Practice (Optional)';
      const p=document.createElement('p'); p.textContent='Opponent says bans on single-use plastics will get rid of thousands of jobs in the industry. Write a 2–3 line frontline (defense).';
      const ta=document.createElement('textarea'); ta.className='form-input'; ta.style.minHeight='120px';
      const counter=document.createElement('div'); counter.textContent='0 chars'; counter.style.fontSize='12px'; counter.style.marginTop='4px';
      ta.addEventListener('input',()=>{ counter.textContent=(ta.value||'').length+' chars'; });
      const btn=document.createElement('button'); btn.className='button'; btn.textContent='Copy to clipboard'; btn.onclick=()=>navigator.clipboard.writeText(ta.value||'');
      card.appendChild(h); card.appendChild(p); card.appendChild(ta); card.appendChild(counter); card.appendChild(btn); container.appendChild(card); },
    function(container){ container.innerHTML=''; const card=makeCard(); card.innerHTML='<h3>Module Complete!</h3><p>Great job completing Rebuttal!</p>'; container.appendChild(card); }
]}

if (!modules.find(m=>m.id==='m8')) modules.push(m8Module);
if (!modules.find(m=>m.id==='m9')) modules.push(m9Module);

(function(){
  const _orig=window.validateCurrentPage;
  window.validateCurrentPage=function(){
    if(!currentModule) return true;
    if(currentModule.id==='m8'){ if(pageIndex===0){ if(m8Module.state.q1!=='2–3'||m8Module.state.q2!=='Clearly and confidently read your case'){ alert('Answer both quick checks correctly to continue.'); return false; } } return true; }
    if(currentModule.id==='m9'){ 
      if(pageIndex===0){ if(m9Module.state.p1!=='4:00'){ alert('Pick 4:00 for 2nd Rebuttal.'); return false; } }
      else if(pageIndex===1){ const items=[["On their Contention 2 about emissions\u2026", 1], ["Also, they said some stuff about the environment\u2026", 0], ["Next, on their third point about costs\u2026", 1], ["They\u2019re wrong, here\u2019s why\u2026", 0]]; let ok=0; items.forEach((it,i)=>{ if(m9Module.state.signpostSelections[i]===it[1]) ok++; }); if(ok!==items.length){ alert('Mark all signposting items correctly to continue.'); return false; } }
      else if(pageIndex===2){ if(m9Module.state.p3!=='Defending your case against their attacks before rebutting theirs'){ alert('Answer the frontlining quick check correctly.'); return false; } }
      else if(pageIndex===4){ const data=[["Opponent: \u201cBanning plastics kills jobs immediately.\u201d", ["Evidence: \u2018Study shows net job growth in alternatives within 6 months.\u2019", "Logic: \u2018Jobs don\u2019t matter.\u2019", "Evidence: \u2018My friend lost a job once.\u2019"], 0], ["Opponent: \u201cEmissions barely change.\u201d", ["Logic: \u2018Your mechanism misses upstream production.\u2019", "Evidence: \u2018Meta-analysis finds 10\u201320% reductions where bans passed.\u2019", "Logic: \u2018We disagree.\u2019"], 1], ["Opponent: \u201cHygiene collapses without plastic.\u201d", ["Evidence: \u2018CDC notes reusables safe with washing; outbreaks not linked to bans.\u2019", "Logic: \u2018That\u2019s silly.\u2019", "Evidence: \u2018Some blogs say bags are dirty.\u2019"], 0]]; let ok=0; data.forEach((d,i)=>{ if(m9Module.state.toolkitAnswers[i]===d[2]) ok++; }); if(ok!==data.length){ alert('Answer all toolkit questions correctly to continue.'); return false; } }
      else if(pageIndex===5){ const lines=[["Our impact is larger in magnitude and happens sooner than theirs.", 1], ["Their argument is dumb.", 0], ["Ours is more probable and less reversible.", 1], ["We disagree; move on.", 0], ["Even if they\u2019re right, our harm outweighs on lives saved.", 1]]; let ok=0,total=0; for(let i=0;i<lines.length;i++){ if(lines[i][1]===1){ total++; if(m9Module.state.weighChecks[i]===1) ok++; } else { if(m9Module.state.weighChecks[i]===1){ alert('Only select the valid weighing lines.'); return false; } } } if(ok!==total){ alert('Select all valid weighing lines to continue.'); return false; } }
      return true; 
    }
    return _orig();
  };
  if (typeof buildModuleList==='function') buildModuleList();
})();
})();
</script>

<!-- Custom UI tweaks: hide status labels, add lock/check icons, and make navigation sticky -->
<style id="custom-module-ui">
  /* Hide the status text completely */
  .module-item .module-button .status {
    display: none !important;
  }
  /* Display a lock icon on locked modules */
  .module-item .module-button.locked::after {
    content: "🔒";
    position: absolute;
    right: 12px;
    top: 50%;
    transform: translateY(-50%);
    font-weight: 900;
    font-size: 14px;
  }
  /* Ensure the content area fills the viewport minus header/footer so navigation remains visible */
  .content {
    display: flex;
    flex-direction: column;
    /* Adjust this value if the header or footer height changes */
    height: calc(100vh - 200px);
    overflow: hidden;
  }
  #page-container {
    flex: 1;
    overflow-y: auto;
    padding-right: 8px;
    padding-bottom: 20px;
  }
  /* Keep navigation controls and progress bar pinned to the bottom of the content area */
  .nav-controls,
  .progress-container {
    position: sticky;
    bottom: 0;
    z-index: 5;
    background: rgba(10,35,66,0.9);
  }
</style>

<!-- Gating logic now implemented directly in buildModuleList; standalone gating script removed -->


<!-- === Modules 10–12 (FROM FINAL.py) === -->
<script>
// Helper UI bits (consistent with existing styles)
function pfCard(title) {
  const card = document.createElement('div');
  card.className = 'card';
  if (title) { const h = document.createElement('h3'); h.textContent = title; card.appendChild(h); }
  return card;
}
// Override the generic good/bad helpers to avoid flooding the background with green/red.
// Instead use a coloured left border so that the white text remains legible on the dark cards.
function good(el){
  el.style.background = '';
  el.style.borderLeft = '6px solid #16a34a';
  el.style.color = '#ffffff';
}
function bad(el){
  el.style.background = '';
  el.style.borderLeft = '6px solid #dc2626';
  el.style.color = '#ffffff';
}
function copyBtn(getText, label='Copy') {
  const b = document.createElement('button'); b.className='primary-btn'; b.textContent=label;
  b.onclick = () => navigator.clipboard.writeText(typeof getText==='function'?getText():getText||'');
  return b;
}

// ------------------------- Module 10 -------------------------
const module10 = {
  id: 'm10',
  title: 'Advanced Rebuttal',
  reward: 50,
  pages: []
};

function m10_p1(container){
  container.innerHTML='';
  const h = document.createElement('h2'); h.textContent = 'Page 1: Advanced Rebuttal — Definitions/Responses'; container.appendChild(h);
  const p = document.createElement('p'); p.textContent = 'Learn advanced techniques for responding to arguments.'; container.appendChild(p);
}
function m10_img(container, idx){
  container.innerHTML='';
  const card = pfCard(`Rebuttal${idx} Image`);
  const img = document.createElement('img');
  img.alt = `Rebuttal${idx}`;
  img.src = `images/Rebuttal${idx}.png`;
  img.style.maxWidth = '100%';
  img.style.border = '1px solid rgba(0,0,0,0.1)';
  img.style.borderRadius = '12px';
  card.appendChild(img);
  const cap = document.createElement('p'); cap.textContent = `images/Rebuttal${idx}.png`; cap.style.fontStyle='italic'; card.appendChild(cap);
  container.appendChild(card);
}
function m10_p11(container){
  container.innerHTML='';
  const card = pfCard('Module Complete!');
  const p = document.createElement('p');
  p.textContent = "Congratulations! You've mastered advanced rebuttal strategies.\n\nYou've earned 50 gems!";
  card.appendChild(p);
  const gem = document.createElement('div'); gem.textContent='💎'; gem.style.fontSize='40px'; card.appendChild(gem);
  container.appendChild(card);
}
module10.pages = [m10_p1];
for (let i=1;i<=9;i++){ module10.pages.push((c)=>m10_img(c,i)); }
module10.pages.push(m10_p11);

// ------------------------- Module 11 -------------------------
const module11 = {
  id: 'm11',
  title: 'Summary & Weighing',
  reward: 20,
  pages: []
};
const m11 = { p1:false, p2:false, p3:false, p4:false, p5:[], p6ok:false };

function m11_p1(container){
  container.innerHTML='';
  const h = document.createElement('h2'); h.textContent='Summary — Purpose'; container.appendChild(h);
  const card = pfCard();
  const desc = "Summary is where you narrow the round. "
             + "Collapse = pick your only strongest contention and only argue that going forward. "
             + "Then make clear comparisons (weighing) so the judge understands why that contention matters most.";
  const p = document.createElement('p'); p.textContent = desc; card.appendChild(p);
  container.appendChild(card);

  const tips = pfCard('Core Moves');
  ['Collapse: pick your best path to the ballot.',
   'Extend: carry claim → warrant → impact you want to win on.',
   'Frontline: briefly answer their best hits on your path.',
   'Weigh: explain why your impact matters more (magnitude / timeframe / probability / reversibility).']
   .forEach(t => { const li = document.createElement('p'); li.textContent = '• '+t; tips.appendChild(li); });
  container.appendChild(tips);

  const quiz = pfCard('Quick Check (must be correct to continue)');
  const rbs=[]; const varObj = {v:-1};
  function pick(){ rbs.forEach(l=>l.style.background=''); if(varObj.v===0){ good(rbs[0]); m11.p1=true; } else { if(varObj.v>=0) bad(rbs[varObj.v]); m11.p1=false; } }
  ['Narrow the round and set up weighing on your best path(s)','Introduce new arguments not in Rebuttal','Read all your cards from Case again']
  .forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px';
                    const inp=document.createElement('input'); inp.type='radio'; inp.name='m11p1'; inp.value=i;
                    inp.onchange=()=>{ varObj.v=i; pick(); };
                    lab.appendChild(inp); lab.append(' '+t); rbs[i]=lab; quiz.appendChild(lab); });
  container.appendChild(quiz);
}

function m11_p2(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Structure Your Summary'; container.appendChild(h);
  const card=pfCard(); const status=document.createElement('p'); status.textContent='Select an option…'; status.style.fontWeight='700'; card.appendChild(status);
  const rbs=[]; const varObj={v:-1};
  function pick(){ const i=varObj.v; rbs.forEach(l=>l.style.background=''); if(i===1){ good(rbs[1]); status.textContent='✔ Correct'; m11.p2=true; } else if(i>=0){ bad(rbs[i]); status.textContent='✖ Try again'; m11.p2=false; } }
  ['Frontline → Rebuttal → Extend → Weigh','Extend → Frontline → Weigh → Extend rebuttals','Weigh → Read new cards → Extend']
   .forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px';
                     const inp=document.createElement('input'); inp.type='radio'; inp.name='m11p2'; inp.value=i;
                     inp.onchange=()=>{ varObj.v=i; pick(); };
                     lab.appendChild(inp); lab.append(' '+t); rbs[i]=lab; card.appendChild(lab); });
  container.appendChild(card);

  const pills = pfCard(); ['Collapse','Extend','Frontline','Weigh'].forEach(t=>{ const s=document.createElement('span'); s.textContent=t; s.style.margin='4px'; s.style.padding='4px 10px'; s.style.border='1px solid rgba(0,0,0,.1)'; s.style.borderRadius='999px'; s.style.display='inline-block'; s.style.background='#eef6ff'; pills.appendChild(s); }); container.appendChild(pills);
}

function m11_p3(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Collapsing — What Do You Keep?'; container.appendChild(h);
  const card=pfCard();
  const scenario = "Scenario: You ran three contentions (Emissions, Economy, Hygiene). They barely answered Emissions; they put lots of defense on Hygiene; Economy trades off with Emissions. Which principles guide what you collapse on?";
  const p=document.createElement('p'); p.textContent=scenario; card.appendChild(p);
  const items=[
    ["Prefer the contention with the clearest offense and the least answered.",1],
    ["Pick the one with the longest card you wrote.",0],
    ["Exploit any true drops (unanswered links/impacts).",1],
    ["Always keep everything to be safe.",0],
    ["Choose the contention that lets you weigh most clearly.",1],
  ];
  const rows=[];
  items.forEach(([txt,ok])=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='6px 8px';
    const cb=document.createElement('input'); cb.type='checkbox';
    cb.onchange=()=>{ lab.style.background = cb.checked ? (ok?'#d1fae5':'#fee2e2') : ''; };
    lab.appendChild(cb); lab.append(' '+txt); card.appendChild(lab); rows.push([lab,cb,ok]); });
  const btn=document.createElement('button'); btn.className='primary-btn'; btn.textContent='Evaluate choices';
  btn.onclick=()=>{ let allOK=true; rows.forEach(([lab,cb,ok])=>{ const pick=cb.checked; const right=(pick&&ok)||(!pick&&!ok); lab.style.background=right?'#d1fae5':'#fee2e2'; if(!right) allOK=false; }); m11.p3=allOK; if(allOK) alert('Nice! Smart collapse choices.'); };
  card.appendChild(btn);
  container.appendChild(card);
}

function m11_p4(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Weighing — Spot the Good Lines'; container.appendChild(h);
  const card=pfCard(); const lead=document.createElement('p'); lead.textContent='Select all lines that actually compare impacts (not just assert disagreement).'; card.appendChild(lead);
  const lines=[
    ["Our impact is larger in magnitude and happens years sooner.",1],
    ["Their claim is wrong.",0],
    ["Even if they win probability, ours outweighs on magnitude (lives).",1],
    ["We disagree; moving on.",0],
    ["Ours is less reversible and affects more people directly.",1],
  ];
  const rows=[];
  lines.forEach(([txt,ok])=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='6px 8px';
    const cb=document.createElement('input'); cb.type='checkbox';
    cb.onchange=()=>{ lab.style.background = cb.checked ? (ok?'#d1fae5':'#fee2e2') : ''; };
    lab.appendChild(cb); lab.append(' '+txt); card.appendChild(lab); rows.push([lab,cb,ok]); });
  const btn=document.createElement('button'); btn.className='primary-btn'; btn.textContent='Evaluate';
  btn.onclick=()=>{ let perfect=true; rows.forEach(([lab,cb,ok])=>{ const pick=cb.checked; const good=(pick&&ok)||(!pick&&!ok); lab.style.background=good?'#d1fae5':'#fee2e2'; if(!good) perfect=false; }); m11.p4=perfect; if(perfect) alert('Great! Those are solid weighing lines.'); };
  card.appendChild(btn);
  container.appendChild(card);
  const pills = pfCard(); ['Magnitude','Timeframe','Probability','Reversibility'].forEach(t=>{ const s=document.createElement('span'); s.textContent=t; s.style.margin='4px'; s.style.padding='4px 10px'; s.style.border='1px solid rgba(0,0,0,.1)'; s.style.borderRadius='999px'; s.style.display='inline-block'; s.style.background='#eef6ff'; pills.appendChild(s); }); container.appendChild(pills);
}

function m11_p5(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Label the Weighing Type'; container.appendChild(h);
  const card=pfCard();
  const prompts=[
    ["“Our policy prevents more deaths overall.”","Magnitude"],
    ["“Our harm arrives in months; theirs is decades away.”","Timeframe"],
    ["“Our scenario is more likely according to consensus studies.”","Probability"],
    ["“Their impact is reversible; ours is permanent.”","Reversibility"],
  ];
  m11.p5 = new Array(prompts.length).fill(null);
  prompts.forEach(([text,answer], i)=>{
    const row=pfCard(); row.style.background='transparent'; row.style.border='none';
    const q=document.createElement('p'); q.innerHTML = `<strong>${i+1}. ${text}</strong>`; row.appendChild(q);
    const opts=['Magnitude','Timeframe','Probability','Reversibility']; const radios=[];
    opts.forEach((t,idx)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px';
      const r=document.createElement('input'); r.type='radio'; r.name='m11p5_'+i; r.value=idx;
      r.onchange=()=>{ radios.forEach(l=>l.style.background=''); if(t===answer){ good(lab); m11.p5[i]=true; } else { bad(lab); m11.p5[i]=false; } };
      lab.appendChild(r); lab.append(' '+t); radios.push(lab); row.appendChild(lab);
    });
    card.appendChild(row);
  });
  container.appendChild(card);
}

function m11_p6(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Weighing Practice — Full Round Context'; container.appendChild(h);
  // Compressed but faithful: includes plastics resolution, PRO/CON bullets, 4 MCQs, and a write/evaluate box.
  const ctx=pfCard('Resolution (context): The U.S. should ban single-use plastics.');
  const grid=document.createElement('div'); grid.style.display='grid'; grid.style.gridTemplateColumns='1fr 1fr'; grid.style.gap='12px';
  const left=pfCard('PRO (ban)'); const right=pfCard('CON (no ban)');
  ['Marine life: fewer entanglements/ingestion.','Public health: lower microplastic exposure.','Climate: modest emissions reduction (plastic from fossil fuels).','Impact example: prevents ~10,000 premature deaths over 10 years (pollution exposure).'].forEach(s=>{ const p=document.createElement('p'); p.textContent='• '+s; left.appendChild(p); });
  ['Jobs: ~120,000 workers disrupted short-term in packaging sectors.','Costs: higher prices for small businesses and consumers.','Hygiene: reusable alternatives can carry bacteria if not washed.','Impact example: regional job losses for 1–2 years (income shocks).'].forEach(s=>{ const p=document.createElement('p'); p.textContent='• '+s; right.appendChild(p); });
  grid.appendChild(left); grid.appendChild(right); ctx.appendChild(grid); container.appendChild(ctx);
  const sample=pfCard('How each side might weigh:');
  const pro=document.createElement('p'); pro.textContent='PRO sample weighing: “Lives outweigh jobs on magnitude and reversibility. Even if job losses happen first, employment recovers in 1–2 years, while deaths are permanent.”'; sample.appendChild(pro);
  const con=document.createElement('p'); con.textContent='CON sample weighing: “Timeframe and probability favor us: job losses are immediate and certain. Their health benefits are spread over a decade and less certain.”'; sample.appendChild(con);
  container.appendChild(sample);
  // MCQs
  const quiz=pfCard('Compare impacts by lens (click an answer):');
  function mcq(prompt, opts, correct){ const row=pfCard(); row.style.background='transparent'; row.style.border='none'; const q=document.createElement('p'); q.textContent=prompt; row.appendChild(q); const labs=[]; opts.forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px'; const r=document.createElement('input'); r.type='radio'; r.name=prompt; r.onchange=()=>{ labs.forEach(l=>l.style.background=''); if(i===correct){ good(lab);} else { bad(lab);} }; lab.appendChild(r); lab.append(' '+t); labs.push(lab); row.appendChild(lab); }); quiz.appendChild(row); }
  mcq('Under MAGNITUDE (how big the impact is), who’s ahead?', ['PRO (lives prevented)','CON (jobs)'], 0);
  mcq('Under TIMEFRAME (which happens sooner), who’s ahead?', ['PRO','CON'], 1);
  mcq('Under REVERSIBILITY (which is harder to undo), who’s ahead?', ['PRO (deaths permanent)','CON (jobs recover)'], 0);
  mcq('Under PROBABILITY (which is more certain here), who’s ahead?', ['PRO','CON (job losses certain if ban passes)'], 1);
  container.appendChild(quiz);
  // Write & evaluate
  const write=pfCard(); const ta=document.createElement('textarea'); ta.rows=4; ta.style.width='100%'; write.appendChild(ta);
  const fb=document.createElement('p'); fb.style.fontWeight='700'; write.appendChild(fb);
  const btn=document.createElement('button'); btn.className='primary-btn'; btn.textContent='Evaluate';
  btn.onclick=()=>{ const t=(ta.value||'').toLowerCase(); const lenses = ['magnitude','timeframe','probability','reversibility']; const used=lenses.filter(w=>t.includes(w)).length>=2; const both=(/\\bwe\\b/.test(t) && (/(they|their|opponent)/.test(t))); if(used && both && t.replace(/\\s+/g,'').length>=20){ fb.textContent='Looks good!'; fb.style.color='#0a7d40'; m11.p6ok=true; } else { fb.textContent='Needs both sides + ≥2 lenses + length.'; fb.style.color='#b91c1c'; m11.p6ok=false; } };
  write.appendChild(btn); container.appendChild(write);
}

function m11_p7(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Roadmap & Signposting'; container.appendChild(h);
  const card=pfCard('Say your roadmap off-time. Keep signposting short and in their order.');
  const pre=document.createElement('pre'); pre.textContent="Roadmap: (1) Frontline their best hit on our C1, (2) Extend C1 with claim → warrant → impact, (3) Weigh — scope + timeframe favor us."; card.appendChild(pre);
  card.appendChild(copyBtn(()=>pre.textContent,'Copy roadmap line'));
  const ex=pfCard('Signposting examples:'); ['On their Hygiene point…','Back to our Economy impact…','Weighing — magnitude & timeframe…'].forEach(s=>{ const p=document.createElement('p'); p.textContent='• '+s; ex.appendChild(p); }); container.appendChild(card); container.appendChild(ex);
}

function m11_p8(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Module Complete!'; container.appendChild(h);
  const card=pfCard(); const p=document.createElement('p'); p.innerHTML='Great work! You practiced collapsing to one contention, extending, frontlining, and clear weighing.<br><br>You’ve earned 20 gems.'; card.appendChild(p); const gem=document.createElement('div'); gem.textContent='💎'; gem.style.fontSize='48px'; card.appendChild(gem); container.appendChild(card);
}
module11.pages = [m11_p1,m11_p2,m11_p3,m11_p4,m11_p5,m11_p6,m11_p7,m11_p8];

// ------------------------- Module 12 -------------------------
const module12 = {
  id: 'm12',
  title: 'Weighing Mechanisms',
  reward: 40,
  pages: []
};
const m12 = { p2:-1,p3:-1,p4:-1,p5:-1,p6:-1,p7:-1, p8ok:false };

function m12_p1(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Weighing Mechanisms'; container.appendChild(h);
  const card=pfCard(); const p=document.createElement('p'); p.textContent='Weighing = comparing impacts so the judge can decide who wins.'; card.appendChild(p);
  const pills=pfCard(); ['Magnitude','Scope','Probability','Timeframe','Link-in','Prerequisite'].forEach(t=>{ const s=document.createElement('span'); s.textContent=t; s.style.margin='4px'; s.style.padding='4px 10px'; s.style.border='1px solid rgba(0,0,0,.1)'; s.style.borderRadius='999px'; s.style.display='inline-block'; s.style.background='#eef6ff'; pills.appendChild(s); }); container.appendChild(card); container.appendChild(pills);
}
function m12_mcq(container, title, prompt, options, correctIndex, storeKey){
  const h=document.createElement('h2'); h.textContent=title; container.appendChild(h);
  const card=pfCard(); if(prompt){ const p=document.createElement('p'); p.textContent=prompt; card.appendChild(p); }
  const labs=[]; function pick(i){ labs.forEach(l=>l.style.background=''); if(i===correctIndex){ good(labs[i]); window.m12[storeKey]=i; } else { bad(labs[i]); window.m12[storeKey]=-1; } }
  options.forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px'; const r=document.createElement('input'); r.type='radio'; r.name=title; r.onchange=()=>pick(i); lab.appendChild(r); lab.append(' '+t); labs[i]=lab; card.appendChild(lab); });
  container.appendChild(card);
}
function m12_p2(c){ m12_mcq(c,'Magnitude','Scenario: A) reduces 5,000 deaths; B) saves $2B in costs.',['A (deaths prevented)','B (money saved)'],0,'p2'); }
function m12_p3(c){ m12_mcq(c,'Scope','Scenario: A) protects 50,000 people; B) protects 3 million.',['A (50k people)','B (3M people)'],1,'p3'); }
function m12_p4(c){ m12_mcq(c,'Probability','Scenario: A) 70% chance, small harm; B) 5% chance, huge harm.',['A (70% likely)','B (5% likely)'],0,'p4'); }
function m12_p5(c){ m12_mcq(c,'Timeframe','Scenario: A) immediate but small; B) begins in 10 years, very large.',['A (immediate)','B (later)'],0,'p5'); }

function m12_p6(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Link-in'; container.appendChild(h);
  const card=pfCard(); const p=document.createElement('p'); p.textContent='Link-in — your argument also triggers their impact, flipping it to your side.'; card.appendChild(p);
  const quiz=pfCard('Which statement is a link-in?');
  const lines=['“Our impact is bigger.”','“Their claimed benefit requires our policy to happen first, so it flows to us.”','“We disagree with their study.”'];
  const labs=[]; lines.forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px'; const r=document.createElement('input'); r.type='radio'; r.name='m12p6'; r.onchange=()=>{ labs.forEach(l=>l.style.background=''); if(i===1){ good(lab); m12.p6=1; } else { bad(lab); m12.p6=-1; } }; lab.appendChild(r); lab.append(' '+t); labs[i]=lab; quiz.appendChild(lab); });
  container.appendChild(card); container.appendChild(quiz);
}

function m12_p7(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Prerequisite'; container.appendChild(h);
  const card=pfCard(); const p=document.createElement('p'); p.textContent='Prerequisite — your impact must occur first for theirs to occur; prioritize the prerequisite.'; card.appendChild(p);
  const quiz=pfCard('Which shows a prerequisite?');
  const lines=['“We might be more likely.”','“Their scenario is less likely.”','“Clean water access must come before economic growth, so fix water first.”'];
  const labs=[]; lines.forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px'; const r=document.createElement('input'); r.type='radio'; r.name='m12p7'; r.onchange=()=>{ labs.forEach(l=>l.style.background=''); if(i===2){ good(lab); m12.p7=2; } else { bad(lab); m12.p7=-1; } }; lab.appendChild(r); lab.append(' '+t); labs[i]=lab; quiz.appendChild(lab); });
  container.appendChild(card); container.appendChild(quiz);
}

function m12_p8(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Weighing Mechanisms — Review'; container.appendChild(h);
  const card=pfCard(); const lead=document.createElement('p'); lead.textContent='Select all statements that correctly define each mechanism.'; card.appendChild(lead);
  const lines=[
    ["Magnitude = how severe the impact is.",1],
    ["Scope = how fast the impact arrives.",0],
    ["Probability = how likely the impact is.",1],
    ["Timeframe = sooner or longer-lasting.",1],
    ["Link-in = your case causes their impact too.",1],
    ["Prerequisite = their impact must happen before yours.",0],
  ];
  const rows=[];
  lines.forEach(([txt,ok])=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='6px 8px';
    const cb=document.createElement('input'); cb.type='checkbox';
    cb.onchange=()=>{ lab.style.background = cb.checked ? (ok?'#d1fae5':'#fee2e2') : ''; };
    lab.appendChild(cb); lab.append(' '+txt); card.appendChild(lab); rows.push([lab,cb,ok]); });
  const btn=document.createElement('button'); btn.className='primary-btn'; btn.textContent='Evaluate';
  btn.onclick=()=>{ let allOK=true; rows.forEach(([lab,cb,ok])=>{ const pick=cb.checked; const right=(pick&&ok)||(!pick&&!ok); lab.style.background=right?'#d1fae5':'#fee2e2'; if(!right) allOK=false; }); m12.p8ok = allOK; if(allOK) alert('Great! Perfect review.'); };
  card.appendChild(btn);
  container.appendChild(card);
}

function m12_p9(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Weighing Drill 1 — Write It'; container.appendChild(h);
  const card=pfCard();
  const prompt="Explain how you outweigh on scope and WHY it matters.\n\nYour Impact: Preventing natural disasters → displacement, deaths, starvation (millions)\nOpponents’ Impact: Increasing green tech investment → 11.3% more innovation; distant mitigation of climate harms";
  const p=document.createElement('p'); p.style.whiteSpace='pre-wrap'; p.textContent=prompt; card.appendChild(p);
  const ta=document.createElement('textarea'); ta.rows=6; ta.style.width='100%'; card.appendChild(ta);
  const hint=document.createElement('p'); hint.textContent='Minimum 25 characters.'; hint.style.fontStyle='italic'; card.appendChild(hint);
  const actions=document.createElement('div'); actions.appendChild(copyBtn(()=>ta.value)); card.appendChild(actions);
  container.appendChild(card);
}
function m12_p10(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Drill 1 — Example Analysis'; container.appendChild(h);
  const card=pfCard();
  const content="The first impact has larger scope and shorter timeframe: natural disasters affect and kill millions now. Even if tech investment helps later, immediacy and scale make preventing disasters more urgent.";
  const p=document.createElement('p'); p.textContent=content; card.appendChild(p);
  const quiz=pfCard('Which lens is MOST emphasized above?');
  const options=['Scope','Probability','Reversibility']; const labs=[];
  options.forEach((t,i)=>{ const lab=document.createElement('label'); lab.style.display='block'; lab.style.padding='4px 8px'; const r=document.createElement('input'); r.type='radio'; r.name='m12p10'; r.onchange=()=>{ labs.forEach(l=>l.style.background=''); if(i===0){ good(lab);} else { bad(lab);} }; lab.appendChild(r); lab.append(' '+t); labs[i]=lab; quiz.appendChild(lab); });
  container.appendChild(card); container.appendChild(quiz);
}
function m12_p11(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Weighing Drill 2 — Write It'; container.appendChild(h);
  const card=pfCard();
  const prompt="Explain how you outweigh and WHY it matters.\n\nYour Impact: Decreasing emissions → eliminate 6B lbs CO₂; ~7M die each year from air pollution\nOpponents’ Impact: Recession → global spillover; 100M into poverty";
  const p=document.createElement('p'); p.style.whiteSpace='pre-wrap'; p.textContent=prompt; card.appendChild(p);
  const ta=document.createElement('textarea'); ta.rows=6; ta.style.width='100%'; card.appendChild(ta);
  const hint=document.createElement('p'); hint.textContent='Minimum 25 characters.'; hint.style.fontStyle='italic'; card.appendChild(hint);
  const actions=document.createElement('div'); actions.appendChild(copyBtn(()=>ta.value)); card.appendChild(actions);
  container.appendChild(card);
}
function m12_p12(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Drill 2 — Example Analysis'; container.appendChild(h);
  const card=pfCard();
  const answer="Reducing air pollution emphasizes magnitude and probability: it directly saves millions of lives every year and is ongoing. Economic shocks can be severe, but recovery is possible and the path from poverty to deaths is indirect.";
  const p=document.createElement('p'); p.textContent=answer; card.appendChild(p);
  const line="Template to reuse: “Even if they win X, we outweigh on [magnitude/timeframe/probability/scope].”";
  card.appendChild(copyBtn(()=>line,'Copy template'));
  container.appendChild(card);
}
function m12_p13(container){
  container.innerHTML='';
  const h=document.createElement('h2'); h.textContent='Module Complete!'; container.appendChild(h);
  const card=pfCard(); const p=document.createElement('p'); p.innerHTML='Nice work! You practiced all six weighing lenses and wrote clear, judge-friendly comparisons.<br><br>You’ve earned 40 gems.'; card.appendChild(p); const gem=document.createElement('div'); gem.textContent='💎'; gem.style.fontSize='48px'; card.appendChild(gem); container.appendChild(card);
}
module12.pages = [m12_p1,m12_p2,m12_p3,m12_p4,m12_p5,m12_p6,m12_p7,m12_p8,m12_p9,m12_p10,m12_p11,m12_p12,m12_p13];

// Register and refresh
if (typeof modules !== 'undefined' && Array.isArray(modules)) {
  const ids = new Set(['m10','m11','m12']);
  for (let i=modules.length-1; i>=0; i--) { if (ids.has(modules[i]?.id)) modules.splice(i,1); }
  modules.push(module10, module11, module12);
  try { if (typeof buildModuleList === 'function') buildModuleList(); } catch(e){}
}

// Validation gates
(function(){
  const base = (typeof validateCurrentPage==='function') ? validateCurrentPage : () => true;
  window.validateCurrentPage = function(){
    if (!base()) return false;
    if (!window.currentModule) return true;
    const id = currentModule.id;
    const p = window.pageIndex;

    if (id==='m11'){
      if (p===0 && !m11.p1) { alert('Pick the main goal of Summary correctly.'); return false; }
      if (p===1 && !m11.p2) { alert('Pick the correct default order.'); return false; }
      if (p===2 && !m11.p3) { alert('Click “Evaluate choices” and get them all right.'); return false; }
      if (p===3 && !m11.p4) { alert('Click “Evaluate” and select all and only the good lines.'); return false; }
      if (p===4 && (!m11.p5.length || m11.p5.some(v=>v!==true))) { alert('Label each weighing type correctly.'); return false; }
      if (p===5 && !m11.p6ok) { alert('Write your line and click Evaluate (needs ≥2 lenses, both sides).'); return false; }
    }
    if (id==='m12'){
      if (p===1 && m12.p2!==0) { alert('Magnitude: choose correctly.'); return false; }
      if (p===2 && m12.p3!==1) { alert('Scope: choose correctly.'); return false; }
      if (p===3 && m12.p4!==0) { alert('Probability: choose correctly.'); return false; }
      if (p===4 && m12.p5!==0) { alert('Timeframe: choose correctly.'); return false; }
      if (p===5 && m12.p6!==1) { alert('Pick the link-in statement.'); return false; }
      if (p===6 && m12.p7!==2) { alert('Pick the prerequisite statement.'); return false; }
      if (p===7 && !m12.p8ok) { alert('Click Evaluate and get the review all correct.'); return false; }
    }
    return true;
  };
})();
</script>

<!-- === Modules 13–15 (self-contained) === -->
<script>

// === Local helpers for modules 13–15 (self-contained) ===
function _mk(tag, text){ const el=document.createElement(tag); if(text!=null){ el.textContent=text; } return el; }
function _h2(t){ return _mk('h2', t); }
function _h3(t){ return _mk('h3', t); }
function _p(t){ return _mk('p', t); }
function _card(){ const d=document.createElement('div'); d.className='card';
  // Use a dark translucent background and light text to ensure readability.  The original
  // white cards caused white text to disappear.  This palette matches the overall
  // dark theme of the app and keeps content legible.
  d.style.background='rgba(10,35,66,0.85)';
  d.style.color='#e0f4ff';
  d.style.borderRadius='12px';
  d.style.padding='12px';
  d.style.margin='10px 0';
  return d; }
function _pill(t){ const s=document.createElement('span'); s.textContent=t; s.style.display='inline-block'; s.style.padding='6px 10px'; s.style.margin='4px'; s.style.borderRadius='999px'; s.style.border='1px solid rgba(0,0,0,.1)'; s.style.background='#eef6ff'; s.style.color='#1d4ed8'; return s; }
function _choice(parent, text, onpick){ const lab=document.createElement('label'); lab.textContent=text; lab.style.display='block'; lab.style.padding='6px 8px'; lab.style.cursor='pointer'; lab.style.border='1px solid rgba(0,0,0,.08)'; lab.style.borderRadius='8px'; lab.style.margin='6px 0'; lab.onmouseenter=()=>lab.style.background='rgba(0,0,0,0.04)'; lab.onmouseleave=()=>lab.style.background=''; lab.onclick=()=>onpick(lab); parent.appendChild(lab); return lab; }
function _mark(lab, ok, status){
  // Clear background on sibling choices
  Array.from(lab.parentElement.children).forEach(n=>{
    n.style.background='';
    n.style.color='';
  });
  // Apply dark green/red backgrounds and light text to the selected label
  lab.style.background = ok ? '#14532d' : '#7f1d1d';
  lab.style.color = '#e0f4ff';
  if(status){
    status.textContent = ok ? '✔ Correct' : '✖ Try again';
    status.style.color = ok ? '#34d399' : '#f87171';
  }
}
function _pre(text){
  const pre=document.createElement('pre');
  pre.style.whiteSpace='pre-wrap';
  // Dark background with light text so the content is readable
  pre.style.background='rgba(10,35,66,0.85)';
  pre.style.color='#e0f4ff';
  pre.style.padding='12px';
  pre.style.borderRadius='8px';
  pre.textContent=text;
  return pre;
}


// ===== Module 13 — Final Focus =====
const m13State = { p2:-1, p3:-1, p5a:-1, p5b:-1 };

function m13_p1(c){ c.innerHTML=''; const card=_card(); card.appendChild(_h2('What is Final Focus?')); card.appendChild(_p("Final Focus (2 minutes) \u2014 your last, clearest case for why you win.")); c.appendChild(card);
  const bullets=_card(); bullets.appendChild(_h3('Key Points')); const ul=document.createElement('ul'); ul.style.marginLeft='1rem';
  ["It should mirror your Summary \u2014 basically a shorter, stronger version of your Summary.", "If your opponent brings up anything new in their second Summary, you must respond to it in your Final Focus.", "Limited time, so focus on winning your case and weighing.", "End with a simple, judge-friendly reason you win."].forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); });
  bullets.appendChild(ul); c.appendChild(bullets);
  const pills=_card(); ['Collapse','Frontline','Weigh','Clear Ask'].forEach(t=>pills.appendChild(_pill(t))); c.appendChild(pills);
}

function m13_p2(c){ c.innerHTML=''; c.appendChild(_h2('Structure & Collapse (Practice)'));
  const note=_card(); const i=_p("Note: You usually decide what to collapse on during Summary. This page gives you extra practice choosing the right contention."); i.style.fontStyle='italic'; note.appendChild(i); c.appendChild(note);
  const chips=_card(); ['Collapse →','Frontline →','Weigh →','Clear ask'].forEach(t=>chips.appendChild(_pill(t))); c.appendChild(chips);
  const scen=_card(); scen.appendChild(_p("Scenario: You won clean concessions...hospital infections dropping by 30,000 lives with your policy. You also have a smaller economy argument that was contested.")); c.appendChild(scen);
  const quiz=_card(); quiz.appendChild(_h3('Which is the best collapse choice? (practice)')); const status=_p('Select an option…'); status.style.fontWeight='600'; quiz.appendChild(status);
  ["Collapse on the hospital infections lives argument.", "Try to cover both arguments equally.", "Abandon the life-saving point for economy."].forEach((t,i)=>{ _choice(quiz, t, (lab)=>{ m13State.p2=i; _mark(lab, i===0, status); }); });
  c.appendChild(quiz);
}

function m13_p3(c){ c.innerHTML=''; c.appendChild(_h2('Weighing — Snap Quiz')); const card=_card(); card.appendChild(_p("Pick the strongest weighing line for the hospital infections scenario.")); const status=_p('Select an option…'); status.style.fontWeight='600'; card.appendChild(status);
  ["Weigh magnitude vaguely: \u2018Ours is bigger.\u2019", "Lives are immediate and irreversible, so preventing 30,000 deaths outweighs their contested economy claim.", "Weigh scope by restating our case without numbers."].forEach((t,i)=>{ _choice(card, t, (lab)=>{ m13State.p3=i; _mark(lab, i===1, status); }); });
  c.appendChild(card);
}

function m13_p4(c){ c.innerHTML=''; c.appendChild(_h2('Example Final Focus (Annotated)'));
  const legend=_card(); ['Collapse','Frontline','Weigh','Ask'].forEach(t=>legend.appendChild(_pill(t))); c.appendChild(legend);
  const pre=_card(); pre.appendChild(_pre("Collapse:\\nWe collapse to hospital infections: our policy prevents ~30,000 deaths each year.\\n\\nFrontline:\\nThey said the evidence is old, but we a...DC report and they never responded\u2014so the reduction stands.\\n\\nWeigh:\\nLives are immediate and irreversible. Even ...enting tens of thousands of deaths matters more and sooner.\\n\\nAsk:\\nThat means you s...at saves lives now. We win on the clearest impact and timeframe.")); c.appendChild(pre);
}

function m13_p5(c){ c.innerHTML=''; c.appendChild(_h2('Lightning Scenario — Collapse & Weigh'));
  const ctx=_card(); ctx.appendChild(_h3('Context:')); ctx.appendChild(_pre("Ban on single-use plastics:\\n\u2022 Pro: reduces pollution-related deaths (peer-reviewed sources, unrefuted)\\n\u2022 Con: costs jobs and raises prices (disputed; no clear numbers)")); c.appendChild(ctx);
  const qa=_card(); qa.appendChild(_h3('A) What should you collapse on? (practice)')); const sa=_p('Select an option…'); sa.style.fontWeight='600'; qa.appendChild(sa);
  ["Pro\u2019s life-saving impact (pollution deaths prevented).", "Both equally to keep options open.", "Con\u2019s jobs/costs despite weaker proof."].forEach((t,i)=>{ _choice(qa, t, (lab)=>{ m13State.p5a=i; _mark(lab, i===0, sa); }); }); c.appendChild(qa);
  const qb=_card(); qb.appendChild(_h3('B) Which primary lens fits best for the Final Focus?')); const sb=_p('Select an option…'); sb.style.fontWeight='600'; qb.appendChild(sb);
  ["Scope (how many people) only.", "Probability (likelihood) only.", "Timeframe + magnitude: preventing deaths now outweighs uncertain economic effects."].forEach((t,i)=>{ _choice(qb, t, (lab)=>{ m13State.p5b=i; _mark(lab, i===2, sb); }); }); c.appendChild(qb);
}

function m13_p6(c){ c.innerHTML=''; c.appendChild(_h2('Module Complete!')); const done=_card(); done.appendChild(_p('Nice work! You practiced collapsing, frontlining, weighing, and a clear Final Focus.')); done.appendChild(_p('You’ve earned ' + m13.reward + ' gems.')); c.appendChild(done); const gem=_mk('div','💎'); gem.style.fontSize='48px'; gem.style.textAlign='center'; c.appendChild(gem); }

const m13 = { id:'m13', title:'Final Focus', reward:10, pages:[m13_p1,m13_p2,m13_p3,m13_p4,m13_p5,m13_p6] };


// ===== Module 14 — Judges & Adaptation =====
const m14State = { p3:-1, p4:-1, p5:-1, p6:-1, p8:-1 };

function m14_p1(c){ c.innerHTML=''; c.appendChild(_h2('Judges & Paradigms — Why They Matter'));
  const a=_card(); a.appendChild(_p('Judges decide the round, and they evaluate differently. A “paradigm” is how a judge explains what they value and how they’ll decide.')); c.appendChild(a);
  const b=_card(); b.appendChild(_h3('In this module you’ll learn to:')); const ul=document.createElement('ul'); ul.style.marginLeft='1rem';
  ["Spot the 4 common PF judge types.", "Adapt your speaking and weighing to each paradigm.", "Run quick checks to keep your speeches judge-friendly."].forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); });
  b.appendChild(ul); c.appendChild(b);
}

function m14_p2(c){ c.innerHTML=''; c.appendChild(_h2('Judge Types at a Glance'));
  const legend=_card(); legend.appendChild(_p('Experience scale: ★ (least) → ★★★★★ (most)')); c.appendChild(legend);
  const grid=_card();
  [["Lay \u2014 persuasion first", "\u2605\u2606\u2606\u2606\u2606", "(Least experienced)", ["Simple language", "Clear organization", "Real-world logic > jargon"]], ["Flay \u2014 balanced", "\u2605\u2605\u2605\u2606\u2606", "(Moderately experienced)", ["Tracks arguments but values clarity", "Signposting & weighing matter"]], ["Flow \u2014 technical", "\u2605\u2605\u2605\u2605\u2606", "(Highly experienced)", ["Line-by-line & extensions", "Precise weighing beats vibe"]], ["Tech \u2014 most technical", "\u2605\u2605\u2605\u2605\u2605", "(Most experienced)", ["Rules > truth if dropped", "Perfect extensions + calculus"]]].forEach(([title,stars,tag,points])=>{ const wrap=_card(); wrap.style.background='transparent';
      const bar=_mk('div');
      bar.style.background='#eef6ff';
      bar.style.border='1px solid #93c5fd';
      bar.style.borderRadius='10px';
      bar.style.padding='6px 10px';
      bar.style.marginBottom='6px';
      // Use dark text on the light bar so it remains legible against the pale background
      bar.style.color='#0b1a2b';
      bar.textContent = title + ' — Experience: ' + stars + ' ' + tag;
      wrap.appendChild(bar);
      points.forEach(pt=>wrap.appendChild(_p('• '+pt)));
      grid.appendChild(wrap);
  });
  c.appendChild(grid);
  const lab=_card(); lab.appendChild(_h3('Pick a judge type to see a quick adaptation line:'));
  const sel=document.createElement('select'); ['Lay','Flay','Flow','Tech'].forEach(x=>{ const o=document.createElement('option'); o.value=x; o.textContent=x; sel.appendChild(o); });
  const out=_p(''); lab.appendChild(sel); lab.appendChild(out); const msg={"Lay":"I’ll slow down, cut jargon, and tie every point to real people.","Flay":"I’ll keep it structured and persuasive: clean signposting + clear weighing.","Flow":"I’ll extend, go line-by-line, and give explicit impact calculus.","Tech":"I’ll execute perfectly on extensions and theory; clear voters at the end."};
  sel.addEventListener('change',()=> out.textContent = msg[sel.value]); out.textContent = msg['Lay']; c.appendChild(lab);
}

function m14_p3(c){ c.innerHTML=''; c.appendChild(_h2("Lay Judges"));
  const quiz=_card(); const status=_p('Select an option…'); status.style.fontWeight='600'; quiz.appendChild(status);
  ["Define terms, use simple language, and keep a clean structure.", "Spread quickly and use circuit jargon.", "Skip weighing and hope they \u2018get it\u2019."].forEach((t,i)=>{ _choice(quiz, t, (lab)=>{ m14State.p3=i; _mark(lab, i===0, status); }); });
  c.appendChild(quiz);
}

function m14_p4(c){ c.innerHTML=''; c.appendChild(_h2("Flay Judges"));
  const quiz=_card(); const status=_p('Select an option…'); status.style.fontWeight='600'; quiz.appendChild(status);
  ["Prioritize style over structure.", "Only read cards; no explanations.", "Balance line-by-line with clear, persuasive weighing."].forEach((t,i)=>{ _choice(quiz, t, (lab)=>{ m14State.p4=i; _mark(lab, i===2, status); }); });
  c.appendChild(quiz);
}

function m14_p5(c){ c.innerHTML=''; c.appendChild(_h2("Flow Judges"));
  const quiz=_card(); const status=_p('Select an option…'); status.style.fontWeight='600'; quiz.appendChild(status);
  ["Sounding confident, even without extensions.", "Clean extensions + clear weighing across the flow.", "Avoid signposting to save time."].forEach((t,i)=>{ _choice(quiz, t, (lab)=>{ m14State.p5=i; _mark(lab, i===1, status); }); });
  c.appendChild(quiz);
}

function m14_p6(c){ c.innerHTML=''; c.appendChild(_h2("Tech Judges"));
  const quiz=_card(); const status=_p('Select an option…'); status.style.fontWeight='600'; quiz.appendChild(status);
  ["Truth claims without extension.", "Only delivery and charisma.", "Flawless extensions + voters with impact calculus."].forEach((t,i)=>{ _choice(quiz, t, (lab)=>{ m14State.p6=i; _mark(lab, i===2, status); }); });
  c.appendChild(quiz);
}

function m14_p7(c){ c.innerHTML=''; c.appendChild(_h2('Adaptation Lab'));
  const lab=_card(); lab.appendChild(_p('Pick a judge type to see “Do more / Avoid” and a sample ask.')); c.appendChild(lab);
  const sel=document.createElement('select'); ['Lay','Flay','Flow','Tech'].forEach(x=>{ const o=document.createElement('option'); o.value=x; o.textContent=x; sel.appendChild(o); });
  c.appendChild(sel);
  const row=_mk('div'); row.style.display='grid'; row.style.gridTemplateColumns='1fr 1fr'; row.style.gap='12px';
  const left=_card(); left.appendChild(_h3('✅ Do more of')); const doBox=_p(''); doBox.style.whiteSpace='pre-wrap'; left.appendChild(doBox);
  const right=_card(); right.appendChild(_h3('🚫 Avoid')); const avoidBox=_p(''); avoidBox.style.whiteSpace='pre-wrap'; right.appendChild(avoidBox);
  c.appendChild(row); row.appendChild(left); row.appendChild(right);
  const phrase=_card(); phrase.appendChild(_h3('Sample Final Focus ask for this judge:')); const ask=_p(''); ask.style.whiteSpace='pre-wrap'; phrase.appendChild(ask); c.appendChild(phrase);
  const bank={"Lay": {"do": "Short sentences \u2022 Real-life examples \u2022 Slow down on stats\nWeigh in plain words (bigger, sooner, more certain).", "avoid": "Jargon without definitions \u2022 Speeding \u2022 Skipping the \u2018why it matters\u2019.", "ask": "\u201cJudge, our plan saves lives right now and that matters most. Please vote Pro.\u201d"}, "Flay": {"do": "Clear signposting \u2022 Solid extensions \u2022 Comparative weighing\nKeep it persuasive without losing structure.", "avoid": "Over-spreading \u2022 Vibes without warrants \u2022 Disorganized rebuttal.", "ask": "\u201cPrefer our clean extensions and weighing: lives now outweigh small, uncertain costs.\u201d"}, "Flow": {"do": "Line-by-line \u2022 Extend claim + warrant + impact \u2022 Impact calculus (mag/time/prob).", "avoid": "New arguments late \u2022 No links \u2022 Hand-wavy weighing.", "ask": "\u201cOn their C2, extend Smith \u201923; magnitude + timeframe win\u2014vote Pro on the flow.\u201d"}, "Tech": {"do": "Perfect extensions \u2022 Theory awareness \u2022 Clear voters \u2022 Explicit calculus.", "avoid": "Truth-only claims \u2022 Dropped links \u2022 Messy collapsing.", "ask": "\u201cOur voters: 1) Lives\u2014extended through FF with warranted link; 2) Timeframe\u2014immediacy. Ballot Pro.\u201d"}}; function refresh(){ const d=bank[sel.value]; doBox.textContent=d.do; avoidBox.textContent=d.avoid; ask.textContent=d.ask; } sel.addEventListener('change', refresh); refresh();
}
function m14_p8(c){ c.innerHTML=''; c.appendChild(_h2('Lightning Scenario — Pick the Adaptation'));
  const ctx=_card(); ctx.appendChild(_p('Context: Judge is **Lay** (Experience: ★☆☆☆☆ — Least). Topic: ban single-use plastics.')); ctx.appendChild(_p('Your best uncontested point: prevents pollution-related deaths now.')); ctx.appendChild(_p('Their best point: potential job losses (disputed, no clear numbers).')); c.appendChild(ctx);
  const quiz=_card(); quiz.appendChild(_h3('What’s the best Final Focus adaptation for THIS judge?')); const status=_p('Select an option…'); status.style.fontWeight='600'; quiz.appendChild(status);
  ["Plain, persuasive ask: \u201cOur plan saves lives now\u2014please prefer that over uncertain job claims.\u201d", "Fast, jargon-heavy line-by-line with theory shells.", "Minimal explanation\u2014just restate your card names."].forEach((t,i)=>{ _choice(quiz, t, (lab)=>{ m14State.p8=i; _mark(lab, i===0, status); }); });
  c.appendChild(quiz);
}
function m14_p9(c){ c.innerHTML=''; c.appendChild(_h2('Wrap-Up & Quick Cheats')); const card=_card(); card.appendChild(_p('Remember: match your speed, structure, and weighing to the judge. Keep extensions clean and voters explicit.')); c.appendChild(card); }
function m14_p10(c){ c.innerHTML=''; c.appendChild(_h2('Module Complete!')); const card=_card(); card.appendChild(_p('You’ve earned ' + m14.reward + ' gems.')); c.appendChild(card); const gem=_mk('div','💎'); gem.style.fontSize='48px'; gem.style.textAlign='center'; c.appendChild(gem); }
const m14 = { id:'m14', title:'Judges & Adaptation', reward:25, pages:[m14_p1,m14_p2,m14_p3,m14_p4,m14_p5,m14_p6,m14_p7,m14_p8,m14_p9,m14_p10] };


// ===== Module 15 — Public Forum AI =====
const m15State = { curr:0, best:0, complete:false, bank: [{"q": "PublicForumAI.com helps beginners learn Public Forum debate.", "a": true, "e": "Yes\u2014PFAI is beginner-friendly with step-by-step modules."}, {"q": "PublicForumAI.com only offers resources for expert-level debaters.", "a": false, "e": "No\u2014content spans middle school to high school and beginners."}, {"q": "The website includes example cases and block files.", "a": true, "e": "Correct\u2014examples and templates help you prep faster."}] };

function m15_p1(c){ c.innerHTML=''; c.appendChild(_h2('Welcome to Public Forum AI'));
  const head=_card(); head.appendChild(_p('Quick module: learn what PublicForumAI.com offers and check your knowledge with a fast True/False quiz.')); c.appendChild(head);
  const what=_card(); what.appendChild(_h3('You’ll do:')); const ul=document.createElement('ul'); ul.style.marginLeft='1rem';
  ['Answer a randomized True/False quiz.','See instant feedback with quick explanations.','Try to build your best streak.'].forEach(t=>{ const li=document.createElement('li'); li.textContent=t; ul.appendChild(li); });
  what.appendChild(ul);
  const begin=document.createElement('button'); begin.className='btn'; begin.textContent='Begin Quiz'; begin.onclick=()=>{ m15State.curr=0; m15State.complete=false; m15State.bank.sort(()=>Math.random()-0.5); goTo(1); };
  what.appendChild(begin); c.appendChild(what);
  const link=_mk('a','Visit PublicForumAI.com'); link.href='https://publicforumai.com'; link.target='_blank'; const wrap=_mk('div'); wrap.style.textAlign='center'; wrap.appendChild(link); c.appendChild(wrap);
}

function m15_p2(c){ c.innerHTML=''; c.appendChild(_h2('True / False Quiz'));
  const top=_card(); const total=m15State.bank.length; top.appendChild(_mk('div','Question ' + (m15State.curr+1) + ' of ' + total));
  const meta=_mk('div'); meta.style.display='flex'; meta.style.gap='16px'; meta.appendChild(_mk('div','Streak: ' + m15State.curr)); meta.appendChild(_mk('div','Best: ' + m15State.best)); top.appendChild(meta); c.appendChild(top);
  const q=m15State.bank[m15State.curr]; const qc=_card(); const qt=_p(q.q); qt.style.fontSize='18px'; qt.style.fontWeight='600'; qc.appendChild(qt);
  const explain=_p(''); explain.style.minHeight='24px'; qc.appendChild(explain);
  const row=_mk('div'); row.style.display='flex'; row.style.gap='12px';
  function answer(val){ if (val===q.a){ explain.textContent='✔ Correct — ' + q.e; explain.style.color='#15803d'; m15State.curr++; if(m15State.curr>m15State.best) m15State.best=m15State.curr; if(m15State.curr<total) setTimeout(()=>goTo(1),600); else { m15State.complete=true; alert('Great! You completed the quiz. Explore features next!'); goTo(2); } } else { explain.textContent='✖ Incorrect — ' + q.e; explain.style.color='#b91c1c'; setTimeout(()=>{ m15State.curr=0; m15State.bank.sort(()=>Math.random()-0.5); alert('Restarting: the quiz will begin from question 1.'); goTo(1); },700); } }
  const bt=_mk('button','True'); bt.className='btn'; bt.onclick=()=>answer(true); const bf=_mk('button','False'); bf.className='btn'; bf.onclick=()=>answer(false);
  row.appendChild(bt); row.appendChild(bf); qc.appendChild(row); c.appendChild(qc);
}

function m15_p3(c){ c.innerHTML=''; c.appendChild(_h2('Feature Explorer — Public Forum AI'));
  if(!m15State.complete){ const guard=_card(); guard.appendChild(_p('Finish the quiz first to unlock this page.')); c.appendChild(guard); return; }
  function feature(title, bullets, accent){ const wrap=_card(); const bar=_mk('div',title); bar.style.background=accent; bar.style.border='1px solid rgba(0,0,0,.1)'; bar.style.padding='6px 10px'; bar.style.fontWeight='700'; wrap.appendChild(bar); bullets.forEach(t=>wrap.appendChild(_p('• '+t))); c.appendChild(wrap); }
  feature('AI Practice Round',['Simulates a real PF round for middle & high school levels','Practice pacing, clarity, and responses in a safe sandbox','Great for first-time competitors to reduce nerves'],'#eef6ff');
  feature('AI Casewriter',['Turn your idea into a draft with claim → warrant → evidence → impact','Refine clarity and organization quickly','Export or copy blocks for your prep docs'],'#fef3c7');
  feature('AI Flow',['Keep clean notes of arguments and responses','See where extensions are missing','Helps you prepare Summary + Final Focus'],'#e9ffe7');
  const act=_card(); act.appendChild(_h3('Open PublicForumAI.com in your browser:')); const btn=_mk('a','Go to PublicForumAI.com'); btn.href='https://publicforumai.com'; btn.target='_blank'; btn.className='btn'; act.appendChild(btn); c.appendChild(act);
}

function m15_p4(c){ c.innerHTML=''; c.appendChild(_h2('Module Complete!')); const card=_card(); card.appendChild(_p('Best streak: ' + m15State.best + ' / ' + m15State.bank.length + '\nYou explored what PFAI offers and cleared the quiz—nice work!')); card.appendChild(_p('You’ve earned ' + m15.reward + ' gems.')); c.appendChild(card); const gem=_mk('div','💎'); gem.style.fontSize='48px'; gem.style.textAlign='center'; c.appendChild(gem); }

const m15 = { id:'m15', title:'Module 15 — Public Forum AI', reward:30, pages:[m15_p1,m15_p2,m15_p3,m15_p4] };


// === Gating for modules 13–15 ===
(function(){
  const base = (typeof validateCurrentPage==='function') ? validateCurrentPage : function(){ return true; };
  window.validateCurrentPage = function(){
    if (!base()) return false;
    if (!window.currentModule) return true;
    const id = currentModule.id;
    const p = window.pageIndex;
    if (id==='m13'){
      if (p===1 && m13State.p2!==0) { alert('Choose the best collapse choice to continue.'); return false; }
      if (p===2 && m13State.p3!==1) { alert('Pick the strongest weighing line to continue.'); return false; }
      if (p===4 && (m13State.p5a!==0 || m13State.p5b!==2)) { alert('Answer both A and B correctly to continue.'); return false; }
    }
    if (id==='m14'){
      if (p===2 && m14State.p3!==0) { alert('Choose the correct option to continue.'); return false; }
      if (p===3 && m14State.p4!==2) { alert('Choose the correct option to continue.'); return false; }
      if (p===4 && m14State.p5!==1) { alert('Choose the correct option to continue.'); return false; }
      if (p===5 && m14State.p6!==2) { alert('Choose the correct option to continue.'); return false; }
      if (p===7 && m14State.p8!==0) { alert('Choose the correct option to continue.'); return false; }
    }
    if (id==='m15'){
      if (p===2 && !m15State.complete) { alert('Finish the quiz first to continue.'); return false; }
    }
    return true;
  };
})();

    <!-- removed: old standalone Module 2 gating now folded into the main validateCurrentPage definition -->

// Register modules and refresh sidebar
if (typeof modules !== 'undefined' && Array.isArray(modules)) {
  ['m13','m14','m15'].forEach(id => {
    const idx = modules.findIndex(m => m.id === id);
    if (idx !== -1) modules.splice(idx,1);
  });
  modules.push(m13, m14);
  if (typeof buildModuleList === 'function') buildModuleList();
}
</script>


<!-- Removed legacy override scripts to prevent conflicting sidebar behavior -->

</body>
</html>